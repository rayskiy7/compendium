<!DOCTYPE html> <html lang="en"><head>
<title>GoPL</title>
<base href=".">
<meta name="pathname" content="gopl.html">
<meta name="description" content="Compendium - GoPL">
<meta property="og:title" content="GoPL">
<meta property="og:description" content="Compendium - GoPL">
<meta property="og:type" content="website">
<meta property="og:url" content="gopl.html">
<meta property="og:image" content="a9s/снимок-экрана-2024-10-22-в-14.54.57.png">
<meta charset="UTF-8"><meta property="og:site_name" content="Compendium"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="preload" href="site-lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/snippets.css"></noscript><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/other-plugins.css"></noscript><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/supported-plugins.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager show-inline-title show-ribbon code-styler code-styler-style-inline code-styler-gutter-highlight is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles">mjx-c.mjx-c2200::before{padding:.694em .556em .022em 0;content:"∀"}mjx-c.mjx-c2283::before{padding:.54em .778em .04em 0;content:"⊃"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c222A::before{padding:.598em .667em .022em 0;content:"∪"}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c1D438.TEX-I::before{padding:.68em .764em 0 0;content:"E"}mjx-c.mjx-c2287::before{padding:.636em .778em .138em 0;content:"⊇"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"∗"}mjx-msup{display:inline-block;text-align:left}mjx-mn{display:inline-block;text-align:left}mjx-c.mjx-c5B::before{padding:.75em .278em .25em 0;content:"["}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"−"}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c5D::before{padding:.75em .278em .25em 0;content:"]"}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c1D453.TEX-I::before{padding:.705em .55em .205em 0;content:"f"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-c.mjx-c210E.TEX-I::before{padding:.694em .576em .011em 0;content:"h"}mjx-c.mjx-c1D464.TEX-I::before{padding:.443em .716em .011em 0;content:"w"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c1D466.TEX-I::before{padding:.442em .49em .205em 0;content:"y"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;font-size-adjust:none;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-texatom{display:inline-block;text-align:left}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("site-lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("site-lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("site-lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("site-lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("site-lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("site-lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("site-lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("site-lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("site-lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("site-lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("site-lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("site-lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("site-lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("site-lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("site-lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("site-lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("site-lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("site-lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("site-lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("site-lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("site-lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("site-lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c1D43A.TEX-I::before{padding:.705em .786em .022em 0;content:"G"}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c1D43B.TEX-I::before{padding:.683em .888em 0 0;content:"H"}mjx-c.mjx-c2014::before{padding:.285em 1em 0 0;content:"—"}</style><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="GoPL_0">GoPL</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-p"><p dir="auto">This is my notes for the book:<br>
<strong>The Go Programming Language</strong> — <em>Alan A. A. Donovan, Brian W. Kernighan</em></p></div><div class="el-h1"><h1 data-heading="Chapter 1: Tutorial" dir="auto" class="heading" id="Chapter_1_Tutorial_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 1: Tutorial</h1></div><div class="el-pre code-styler-pre-parent"><pre><code data-line="0">gofmt — formats a file
go fmt — formats a folder or a package
goimports — auto-formatting of imports
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Increment and decrement only have postfix notation and are statements, not expressions, therefore the following notations are unavailable:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded"><span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">--</span>i
a <span class="token operator">+=</span> <span class="token punctuation">(</span>b<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span>
etc<span class="token punctuation">.</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">The for loop has several forms:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded"><span class="token keyword">for</span> <span class="token operator">&lt;</span>init short statement<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token operator">&lt;</span>condition<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token operator">&lt;</span>operation<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// such as while</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>The short declaration construction := is allowed only inside functions! Not at the package level</p>
</blockquote></div><div class="el-p"><p dir="auto">Concatenation of multiple strings:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded">strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>elements <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Cool use of a hashmap for counting occurrences:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded"><span class="token keyword">for</span> el <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    hashmap<span class="token punctuation">[</span>el<span class="token punctuation">]</span><span class="token operator">++</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Reading standard input:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded">scanner <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span>
<span class="token keyword">for</span> scanner<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">do_with</span><span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Verbs. Keep in mind that they work differently for different types:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-22 в 14.54.57.png" src="a9s/снимок-экрана-2024-10-22-в-14.54.57.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-22 в 14.54.57.png" src="a9s/снимок-экрана-2024-10-22-в-14.54.57.png" target="_self"></span></p></div><div class="el-blockquote"><blockquote dir="auto">
<p><u>Techniques</u>:</p>
</blockquote></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Specifying <code class="code-styler-inline">%[1]d</code> allows you to reuse the 1st argument of the fmt.Printf function</li>
<li data-line="1" dir="auto"><code class="code-styler-inline">#</code> — adds a prefix for octal and hexadecimal systems; also for <code class="code-styler-inline">%#v</code> it adds a Go-syntax representation</li>
<li data-line="2" dir="auto"><code class="code-styler-inline">%*s</code> takes the width and the string itself sequentially from a pair of arguments.</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>To run a command in the background in the terminal, just add "&amp;" to the end of the command</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>In Go, there are both labels and goto.</p>
</blockquote></div><div class="el-h1"><h1 data-heading="Chapter 2: Program Structure" dir="auto" class="heading" id="Chapter_2_Program_Structure_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 2: Program Structure</h1></div><div class="el-p"><p dir="auto">Language keywords:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-22 в 17.56.19.png" src="a9s/снимок-экрана-2024-10-22-в-17.56.19.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-22 в 17.56.19.png" src="a9s/снимок-экрана-2024-10-22-в-17.56.19.png" target="_self"></span><br>
Builtins (can be redefined!):</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-22 в 17.57.07.png" src="a9s/снимок-экрана-2024-10-22-в-17.57.07.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-22 в 17.57.07.png" src="a9s/снимок-экрана-2024-10-22-в-17.57.07.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Standard package for handling command-line flags:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded"><span class="token keyword">import</span> <span class="token string">"flag"</span>

<span class="token keyword">var</span> n <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">Bool</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"description of flag -n"</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"s"</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"description of flag -s"</span><span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Usage:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded"><span class="token keyword">func</span> <span class="token function">someFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    args <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">Args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// you can also just take the input arguments</span>
    <span class="token operator">&lt;</span>use values<span class="token operator">&gt;</span> <span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Dynamic creation of an unnamed variable of type T, returns a pointer!:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded">p <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token comment">// p is var p *int</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Note: For zero-size data like interface{} or [0]int, the same address may be returned</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>The compiler itself determines whether to create a variable on the heap or the stack. Moreover, this is not affected by how it was created (via <em>var</em> or <em>new</em>), since variables can escape the function or, conversely, not escape.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>A doc-comment should be located in only 1 file of the package. It is common practice to place large doc-comments in a separate doc.go file</p>
</blockquote></div><div class="el-p"><p dir="auto">Initialization:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">First, package-level variables, usually in order of declaration (but dependencies are resolved first)</li>
<li data-line="1" dir="auto">Then all init(){...} functions in order of declaration. There can be any number of them</li>
</ol></div><div class="el-p"><p dir="auto">Lexical blocks:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">universe</li>
<li data-line="1" dir="auto">package</li>
<li data-line="2" dir="auto">file</li>
<li data-line="3" dir="auto">construction (for, if, switch)</li>
<li data-line="4" dir="auto">block in switch and select</li>
<li data-line="5" dir="auto">explicit blocks {}</li>
</ol></div><div class="el-p"><p dir="auto">The scope of labels for break, continue, and goto is the entire enclosing function</p></div><div class="el-h1"><h1 data-heading="Chapter 3: Basic Types" dir="auto" class="heading" id="Chapter_3_Basic_Types_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 3: Basic Types</h1></div><div class="el-p"><p dir="auto">Types in Go:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">basic (numbers, strings, booleans)</li>
<li data-line="1" dir="auto">aggregate (arrays, structs)</li>
<li data-line="2" dir="auto">reference (pointers, slices, maps, functions, channels)</li>
<li data-line="3" dir="auto">interface</li>
</ol></div><div class="el-p"><p dir="auto"><u>Numbers</u>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token builtin">int</span><span class="token punctuation">;</span>     <span class="token builtin">int8</span><span class="token punctuation">,</span>       <span class="token builtin">int16</span><span class="token punctuation">,</span>   <span class="token builtin">int32</span><span class="token operator">=</span><span class="token builtin">rune</span><span class="token punctuation">,</span> <span class="token builtin">int64</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token builtin">uint</span><span class="token punctuation">;</span>    <span class="token builtin">uint8</span><span class="token operator">=</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">uint16</span><span class="token punctuation">,</span>  <span class="token builtin">uint32</span><span class="token punctuation">,</span>     <span class="token builtin">uint64</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token function">size</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token number">32</span> <span class="token operator">/</span> <span class="token number">64</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token function">size</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">32</span> <span class="token operator">/</span> <span class="token number">64</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> then accordingly <span class="token function">size</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token builtin">uintptr</span> — large enough to hold a pointer</div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token builtin">complex64</span><span class="token punctuation">,</span> <span class="token builtin">complex128</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Note: even if size(int) = 32, the types int and int32 are not the same</p></div><div class="el-p"><p dir="auto">Operators in decreasing order of precedence (left-associative within a line):</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-23 в 13.44.57.png" src="a9s/снимок-экрана-2024-10-23-в-13.44.57.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-23 в 13.44.57.png" src="a9s/снимок-экрана-2024-10-23-в-13.44.57.png" target="_self"></span></p></div><div class="el-blockquote"><blockquote dir="auto">
<p>The sign of the remainder is always the same as the sign of the dividend</p>
</blockquote></div><div class="el-p"><p dir="auto">Note: when right-shifting signed values, new bits are filled with the value of the sign bit!</p></div><div class="el-p"><p dir="auto">Note: len returns an int, not a uint, which might seem more logical.</p></div><div class="el-p"><p dir="auto">Available notations:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>4.3e-13</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<ol start="43">
<li data-line="1" dir="auto"></li>
</ol>
</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>.0162</li>
</ul></div><div class="el-p"><p dir="auto">Verbs:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>%f displays in floating-point format</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>%e displays in scientific notation</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>%g displays in the most compact representation</li>
</ul></div><div class="el-p"><p dir="auto">Special constants exist:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>math.NaN() -&gt; NaN</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>math.Inf(sign) -&gt; sign*Inf<br>
Note: any comparison with NaN yields false</li>
</ul></div><div class="el-blockquote"><blockquote dir="auto">
<p>SVG — an XML format for drawing polygonal meshes</p>
</blockquote></div><div class="el-p"><p dir="auto"><u>Booleans</u>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token builtin">bool</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Evaluation of &amp;&amp; and || uses short-circuiting</p>
</blockquote></div><div class="el-p"><p dir="auto"><u>Strings and Runes</u>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token builtin">rune</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>They are sequences of bytes<br>
<strong>Important</strong>: copying strings and taking substrings are cheap operations! Since strings are immutable, different strings can share the same memory</p>
</blockquote></div><div class="el-p"><p dir="auto">ASCII escape sequences:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-23 в 16.56.12.png" src="a9s/снимок-экрана-2024-10-23-в-16.56.12.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-23 в 16.56.12.png" src="a9s/снимок-экрана-2024-10-23-в-16.56.12.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">One can also include: \xhh and \ooo</p></div><div class="el-p"><p dir="auto">Raw string literals are defined in backticks:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token string">`raw string literal \n &lt;- prints this as is`</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Note: it only removes carriage return characters for compatibility between different systems</p></div><div class="el-p"><p dir="auto">Unicode character codes can be specified explicitly:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">\uhhhh OR \Uhhhhhhhh</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Examples: "\u4e16" = ‘\u4e16’ = ‘\U00004e16’; A = ‘\x41’</p></div><div class="el-p"><p dir="auto"><strong>IMPORTANT</strong>: a loop can be called like this:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">for</span> <span class="token keyword">range</span> myString <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token operator">&lt;</span>do something<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span> <span class="token comment">// executes as many times as there are runes in myString</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Counting the number of runes in a string: utf8.RuneCountInString(s)</p></div><div class="el-p"><p dir="auto">If decoding a character fails, the decoder generates a special replacement character \UFFFD, which looks like this: </p></div><div class="el-blockquote"><blockquote dir="auto">
<p>Converting an int to a string produces a string consisting of one rune with that code, or \UFFFD in case of failure</p>
</blockquote></div><div class="el-p"><p dir="auto">Packages for working with strings:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">bytes (contains many functions similar to strings)</li>
<li data-line="1" dir="auto">strings</li>
<li data-line="2" dir="auto">strconv</li>
<li data-line="3" dir="auto">unicode</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>Conversions between strings and []byte create new arrays and perform copying (though the compiler may optimize this in some cases)</p>
</blockquote></div><div class="el-p"><p dir="auto">Multiple definition of constants (or variables):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">const</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    e ￼</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    pi ￼</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Constants can be used in some places where variables are unavailable, for example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">const</span> IPv4Len <span class="token operator">=</span> <span class="token number">4</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> ip <span class="token punctuation">[</span>IPv4Len<span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token operator">&lt;</span><span class="token operator">...</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Omissions are allowed if constants are declared in a block:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">const</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    a <span class="token operator">=</span> <span class="token number">1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    b <span class="token comment">// copy previous expression (1) and its type type(1)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    c <span class="token comment">// and this too</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    d <span class="token operator">=</span> <span class="token number">2</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The constant generator iota. It is a variable that increases by 1 each time.</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> Flags <span class="token builtin">uint</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">const</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token boolean">_</span> Flags <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token boolean">iota</span>          <span class="token comment">// = 1 &lt;&lt; 0   it's possible to skip a value</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    FirstFlag        <span class="token comment">// = 1 &lt;&lt; iota = 1 &lt;&lt; 1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    SecondFlag       <span class="token comment">// = 1 &lt;&lt; iota = 1 &lt;&lt; 2</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    ThirdFlag        <span class="token comment">// = 1 &lt;&lt; iota = 1 &lt;&lt; 3</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Constants can be <em>untyped</em>, which allows them to maintain higher precision. There are 6 kinds:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">untyped bool</li>
<li data-line="1" dir="auto">untyped int</li>
<li data-line="2" dir="auto">untyped rune</li>
<li data-line="3" dir="auto">untyped float</li>
<li data-line="4" dir="auto">untyped complex</li>
<li data-line="5" dir="auto">untyped string</li>
</ol></div><div class="el-h1"><h1 data-heading="Chapter 4: Composite Types" dir="auto" class="heading" id="Chapter_4_Composite_Types_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 4: Composite Types</h1></div><div class="el-p"><p dir="auto">Special forms of array initialization:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span> <span class="token comment">// = {1, 5, 0}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token comment">// = {1, 2, 3}, type(b) = [3]int</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">c <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">:</span> <span class="token char">'x'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token char">'y'</span><span class="token punctuation">}</span> <span class="token comment">// = {'', 'y', '', 'x'}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Slicing beyond len(slice) but within cap(slice) extends the resulting slice</p>
</blockquote></div><div class="el-p"><p dir="auto">Important: string slices are strings, while array and slice slices are slices</p></div><div class="el-p"><p dir="auto">Arrays are comparable (==), but slices are not. There is a bytes.Equal function for comparing []byte<br>
The only allowed comparison for a slice (and a map!):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">slice <span class="token operator">==</span> <span class="token boolean">nil</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Clarification regarding nil slices:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-23 в 20.25.22.png" src="a9s/снимок-экрана-2024-10-23-в-20.25.22.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-23 в 20.25.22.png" src="a9s/снимок-экрана-2024-10-23-в-20.25.22.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Function for creating a slice:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">,</span> <span class="token builtin">cap</span><span class="token punctuation">)</span>  <span class="token comment">// cap can be omitted, but not len</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Use the append function to add an element or a slice to a slice, followed by reassignment:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">mysl <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>mysl<span class="token punctuation">,</span> appendix<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>keep in mind that it may return a slice over the same base array or a new one. Typically, the size doubles, but this cannot be assumed for certain</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>copy(dst, src) — copies slice elements from one to another, returning the number of elements actually copied, which is the minimum of the two lengths</li>
</ul></div><div class="el-p"><p dir="auto">Maps.<br>
Deleting an element:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">delete</span><span class="token punctuation">(</span>mymap<span class="token punctuation">,</span> key<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">You cannot take the address of values (due to possible rehashing):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token boolean">_</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>mymap<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// error!</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>For a nil map, everything is generally safe except adding a new element, which causes a panic.</p>
</blockquote></div><div class="el-p"><p dir="auto">Structs.<br>
Important: </p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>you cannot access fields of a value using a dot, only fields of a variable.</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>the order of fields matters; different orders result in different structures.</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>recursion type S struct{next S} is not allowed, but type S struct{next *S} is allowed</li>
</ul></div><div class="el-p"><p dir="auto">Struct literals can be without keys if the order is followed, or without all values if keys are used:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> Point <span class="token keyword">struct</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">p1 <span class="token operator">:=</span> Point<span class="token punctuation">{</span>y<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">}</span>  <span class="token comment">// -&gt; {0, 15}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">p2 <span class="token operator">:=</span> Point<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token comment">// -&gt; {-3, -3}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>A struct consisting of comparable (==) fields is comparable</p>
</blockquote></div><div class="el-p"><p dir="auto">?? Interesting: it is stated that a struct field type can be a pointer to a type.</p></div><div class="el-p"><p dir="auto">After declaring struct fields, string literals called field tags can be specified:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> S <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    x <span class="token builtin">int</span> <span class="token string">`some tag`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    y <span class="token builtin">int</span> <span class="token string">`another tag`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Example for JSON:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token string">`json:"new_name"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token string">`json:"new_name,omitempty"`</span>  <span class="token comment">// omitempty — omit empty or zero values</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Struct literals inside a slice of those structs can be defined without specifying the struct type:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">list <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>MyStruct<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    S<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// S is not required</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Marshaling — converting an object into its JSON representation:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> OR json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> newLinePrefix<span class="token punctuation">,</span> indentPrefix<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">By convention, tags are recorded as a set of the following form:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token string">`key1:"val1" key2:"val2" ...`</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The reverse operation: Unmarshaling. Reading and restoring all fields is not required:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> names <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span>Title <span class="token builtin">string</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>titles<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Additionally:<br>
The json package also offers streaming encoders/decoders:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Text and HTML templates use {{}} constructions. Specifically:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>{{.Field | SomeFunc}} — it is possible to access fields and functions. fmt.Sprintf is built-in as printf</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>{{range .SomeIterable}} … {{end}} — it is possible to create a loop</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>{{if}} {{else}} — choose based on a condition<br>
Usage structure:</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">tmplt<span class="token punctuation">,</span> err <span class="token operator">:=</span> template<span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token function">Funcs</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>FuncMap<span class="token punctuation">{</span><span class="token string">"pattern name"</span><span class="token punctuation">:</span> MyFunc<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token function">Parse</span><span class="token punctuation">(</span>templateString<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">There is a way to crash the program if there is an error:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">tmplt <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>tmplt<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Final usage:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">tmplt</span><span class="token punctuation">(</span>writer<span class="token punctuation">,</span> data<span class="token punctuation">)</span>  <span class="token comment">// -&gt; err</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">HTML templates suppress potential injection attacks and output characters literally. To output an element with HTML formatting, it must be unmarshaled into a field of type template.HTML rather than string.</p></div><div class="el-h1"><h1 data-heading="Chapter 5: Functions" dir="auto" class="heading" id="Chapter_5_Functions_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 5: Functions</h1></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">but</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>resI <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Named return parameters become local variables of the function (with zero values)!<br>
These variables are returned automatically, for example:</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>r <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    r <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">2</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">return</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Input can be ignored:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> f <span class="token punctuation">(</span><span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">OR</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">func</span> f <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Declaring a function without a body indicates its implementation in another language!</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>IMPORTANT: Go's garbage collector frees memory, but not system resources like open files and connections. They must be closed explicitly!</p>
</blockquote></div><div class="el-p"><p dir="auto">Functions are a full-fledged reference type defined by their signature.</p></div><div class="el-p"><p dir="auto">Anonymous functions and their returns, closures:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">squares</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">var</span> k <span class="token builtin">int</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        k<span class="token operator">++</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        <span class="token keyword">return</span> k <span class="token operator">*</span> k</div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Important: all functions outside the package level must be anonymous (but they can be assigned to a variable with a name)</p>
</blockquote></div><div class="el-p"><p dir="auto">Keep in mind:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    g <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">        <span class="token operator">&lt;</span>no access to g here<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">However:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">var</span> g <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    g <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        <span class="token operator">&lt;</span>there <span class="token function">is</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">)</span> access to g here<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p><strong>VERY IMPORTANT:</strong> In closures, you should not capture loop variables because they change, and the closures will end up with the same value: the one from the final iteration of the loop. <strong>UPD</strong>: It seems this has been addressed in newer versions of the language!!!</p>
</blockquote></div><div class="el-p"><p dir="auto">A bit about variadic functions (with the <code class="code-styler-inline">...</code> argument):</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">When calling such a function, an array is implicitly created that copies the input values and passes a slice of the entire array.</li>
<li data-line="1" dir="auto">These are different types: <code class="code-styler-inline">func([]int)</code> and <code class="code-styler-inline">func(...int)</code>.</li>
</ol></div><div class="el-p"><p dir="auto">About <code class="code-styler-inline">defer</code>:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Arguments are evaluated at the moment of the call, but the call itself is deferred.</li>
<li data-line="1" dir="auto">Deferred calls are executed in reverse order (LIFO).</li>
<li data-line="2" dir="auto">The result of a function is calculated BEFORE the deferred functions are executed. Therefore, a deferred function can read and even modify the return values of the enclosing function!</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>Not all <code class="code-styler-inline">close()</code> calls should be deferred, as some of them may return errors themselves.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>There is no point in doing an <code class="code-styler-inline">if</code> check with a <code class="code-styler-inline">panic</code> call if the program will crash on its own from an invalid state.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>It is a common convention to name a function <b><u>Must</u></b>SomeNameTail if it needs to throw a panic in case of failure. Usually, only things that are CERTAIN to work are passed to such functions.</p>
</blockquote></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">recover</code>:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Can be called without a panic situation; in that case, it does nothing and returns <code class="code-styler-inline">nil</code>.</li>
<li data-line="1" dir="auto">The panic value has the type <code class="code-styler-inline">interface{}</code> and can be anything.</li>
<li data-line="2" dir="auto">One must be extremely careful: recovering from a panic can be dangerous, and the program state may remain "corrupted" and invisible. If you do this, it's best to keep it within a single package.</li>
<li data-line="3" dir="auto">Some situations are unrecoverable (e.g., memory exhaustion). The program terminates with a fatal error.</li>
</ol></div><div class="el-p"><p dir="auto">Functions can be embedded in interfaces:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> MyInt <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    f <span class="token keyword">func</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 6: Methods" dir="auto" class="heading" id="Chapter_6_Methods_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 6: Methods</h1></div><div class="el-blockquote"><blockquote dir="auto">
<p>A function and a method can have the same name ;)</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>Methods cannot be declared for named types whose underlying type is an interface or a pointer.</p>
</blockquote></div><div class="el-p"><p dir="auto">The name of a method with a pointer receiver is:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token punctuation">(</span><span class="token operator">*</span>T<span class="token punctuation">)</span><span class="token punctuation">.</span>Method</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>CONVENTION: All methods should take either <code class="code-styler-inline">T</code> or <code class="code-styler-inline">*T</code>; do not mix them (even though it's possible).</p>
</blockquote></div><div class="el-p"><p dir="auto">Another trap! You cannot call a method with a pointer receiver even with implicit address-taking (<code class="code-styler-inline">&amp;</code>) if you are calling it on a value (like a literal), because addresses can only be taken from variables, not values! Such a call is impossible:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">T<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// attempts to take &amp;T{}, but this is not allowed</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">nil</code> is a valid pointer for a receiver:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token operator">...</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token function">T</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">But not like this (because <code class="code-styler-inline">nil</code> has no type by itself):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token boolean">nil</span><span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// compile error</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Promoted methods resulting from embedding take the embedded struct field as the receiver, not the entire new struct. Furthermore, arguments must be given the exact type, not a derived one! (Thus, there is no full inheritance in OOP terms!)</p></div><div class="el-p"><p dir="auto">You can also embed a pointer to a named type, for example, to implement lists:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> List <span class="token keyword">struct</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    El <span class="token builtin">int</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    Next <span class="token operator">*</span>List</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">When calling an object method <code class="code-styler-inline">ob := MyType(...); ob.Method</code>, the compiler searches for the method in order:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Directly the method <code class="code-styler-inline">Method</code> of type <code class="code-styler-inline">MyType</code>.</li>
<li data-line="1" dir="auto">Methods promoted once (from types embedded in <code class="code-styler-inline">MyType</code>).</li>
<li data-line="2" dir="auto">Methods promoted twice (from types embedded in types embedded in <code class="code-styler-inline">MyType</code>).</li>
<li data-line="3" dir="auto">And so on...<br>
If there are two methods with the same name at the same "promotion level," a compilation error occurs!</li>
</ol></div><div class="el-p"><p dir="auto">In the case of fields (verified in practice), the same situation occurs.</p></div><div class="el-p"><p dir="auto">Unnamed structs can have embedded methods. Here is an extremely interesting example:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-24 в 15.56.10.png" src="a9s/снимок-экрана-2024-10-24-в-15.56.10.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-24 в 15.56.10.png" src="a9s/снимок-экрана-2024-10-24-в-15.56.10.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">There is a concept of a <em>method value</em>, which is essentially a bounded method:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">f <span class="token operator">:=</span> t<span class="token punctuation">.</span>Method <span class="token comment">// returns in f a func() that can be called later with the receiver t already set</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// direct call</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The call is also available in <em>unbounded</em> form (method expression):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">T<span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span>receiver T<span class="token punctuation">,</span> <span class="token operator">&lt;</span>all args<span class="token operator">&gt;</span><span class="token punctuation">)</span> </div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">OR</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">(</span><span class="token operator">*</span>T<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span>receiver <span class="token operator">*</span>T<span class="token punctuation">,</span> <span class="token operator">&lt;</span>all args<span class="token operator">&gt;</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">One must be careful because <code class="code-styler-inline">fmt</code> package functions look for <code class="code-styler-inline">func (T) String() string</code> for type <code class="code-styler-inline">T</code>, and <code class="code-styler-inline">func (*T) String() string</code> for type <code class="code-styler-inline">*T</code>. Thus, to correctly print an object that only has a method for <code class="code-styler-inline">*T</code>, you must do:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>obj<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Expression for determining the bitness of <code class="code-styler-inline">int</code>/<code class="code-styler-inline">uint</code> types:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token number">32</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token operator">^</span><span class="token function">uint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">63</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Sometimes you need to intentionally encapsulate something in a struct:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> Set <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint64</span>  <span class="token comment">// bad, there is external access to the slice</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">type</span> Set <span class="token keyword">struct</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    words <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint64</span>  <span class="token comment">// good, there is no external access to the slice</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Once more regarding convention:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Setters are named with <code class="code-styler-inline">Set</code>.</li>
<li data-line="1" dir="auto">Getters are named WITHOUT <code class="code-styler-inline">Get</code>.</li>
</ol></div><div class="el-h1"><h1 data-heading="Chapter 7: Interfaces" dir="auto" class="heading" id="Chapter_7_Interfaces_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 7: Interfaces</h1></div><div class="el-p"><p dir="auto">An interface is a set of methods (not functions).<br>
Example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> Figure <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token function">Rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token function">Scale</span><span class="token punctuation">(</span>factor <span class="token builtin">float64</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Built-in interfaces:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> io<span class="token punctuation">.</span>Writer <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token function">Write</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">type</span> io<span class="token punctuation">.</span>Reader <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token keyword">type</span> io<span class="token punctuation">.</span>Closer <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token keyword">type</span> fmt<span class="token punctuation">.</span>Stringer <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Interface composition (embedding) is allowed:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> ReadWriteCloser <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    Reader</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    Writer</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    Closer</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><strong>Once again, IMPORTANT</strong>:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Values of type <code class="code-styler-inline">T</code> do not possess all methods that a pointer <code class="code-styler-inline">*T</code> does, and therefore may satisfy fewer interfaces! Conversely, all methods apply to the pointer <code class="code-styler-inline">*T</code> because dereferencing (<code class="code-styler-inline">*</code>) is always available.</li>
</ul></div><div class="el-p"><p dir="auto">Checking interface compliance at runtime without allocating explicit memory or a variable:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> <span class="token boolean">_</span> io<span class="token punctuation">.</span>Writer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Scanning the string <code class="code-styler-inline">in</code> according to a <code class="code-styler-inline">template</code> and returning values into multiple passed pointer receivers:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">fmt<span class="token punctuation">.</span><span class="token function">Sscanf</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> template<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myint<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mystring<span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">...</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>  <span class="token comment">// returns errors if any!</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">You can define your own flags for the <code class="code-styler-inline">flag</code> package. You need to implement the interface:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> flag<span class="token punctuation">.</span>Value <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token function">Set</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">// suppose we implemented type TValue struct{Val T}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Creating your own flag:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">MyTFlag</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> value T<span class="token punctuation">,</span> usage <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>T <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    t <span class="token operator">:=</span> TValue<span class="token punctuation">{</span>value<span class="token punctuation">}</span>  <span class="token comment">// (or not as a struct) then change the line (##)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    flag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">Var</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t<span class="token punctuation">,</span> name<span class="token punctuation">,</span> usage<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token keyword">return</span> <span class="token operator">&amp;</span>t<span class="token punctuation">.</span>Val  <span class="token comment">// (##)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">In reality, an interface is a dynamic pair of pointer + value, essentially:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">struct</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">type</span>  <span class="token builtin">uintptr</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    value SomeType</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">I.e., an interface value is a reference to a type and data.</p></div><div class="el-p"><p dir="auto">They can be compared like a reference:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> t SomeInterfaceType  <span class="token comment">// = {nil, nil}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">t <span class="token operator">==</span> <span class="token boolean">nil</span>  <span class="token comment">// true</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>They can even be compared to each other with <code class="code-styler-inline">==</code>; if their types are equal and values pass the <code class="code-styler-inline">==</code> check, it will be <code class="code-styler-inline">true</code>. But be careful: if the types are equal but the values themselves are incomparable (e.g., slices), it will trigger a panic.<br>
Conclusion: comparing interfaces is tricky and should only be done when their dynamic values have comparable types.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>Attention: there can be an interface with a non-nil type but a nil value; one might think such an object <code class="code-styler-inline">== nil</code>, but in reality, the check will yield <code class="code-styler-inline">false</code> because an interface is only <code class="code-styler-inline">nil</code> when it is entirely <code class="code-styler-inline">nil</code> ({nil, nil}).</p>
</blockquote></div><div class="el-p"><p dir="auto">Useful:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"text/tabwriter"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">http<span class="token punctuation">.</span>ServeMux — request multiplexer</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Go does not have a framework like Django in Python, but it's simply not needed!<br>
Usage:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// var full</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/any/route/path"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>anyRoutePathHandler<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/other/route/path"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>otherRoutePathHandler<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>and so on<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> mux<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">OR</div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token comment">// var middle</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/any/route/path"</span><span class="token punctuation">,</span> anyRoutePathHandler<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/other/route/path"</span><span class="token punctuation">,</span> otherRoutePathHandler<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>and so on<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> mux<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text">OR</div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text"><span class="token comment">// var profi</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/any/route/path"</span><span class="token punctuation">,</span> anyRoutePathHandler<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/other/route/path"</span><span class="token punctuation">,</span> otherRoutePathHandler<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>and so on<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text">log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Very interesting approach:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-24 в 22.43.37.png" src="a9s/снимок-экрана-2024-10-24-в-22.43.37.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-24 в 22.43.37.png" src="a9s/снимок-экрана-2024-10-24-в-22.43.37.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Interface type assertion:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">x<span class="token punctuation">.</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">If <code class="code-styler-inline">T</code> is a concrete type, it returns the dynamic value of <code class="code-styler-inline">x</code> with type <code class="code-styler-inline">T</code>. (If the dynamic type of <code class="code-styler-inline">x</code> is not <code class="code-styler-inline">T</code>, a panic occurs)</li>
<li data-line="1" dir="auto">If <code class="code-styler-inline">T</code> is an interface type, the dynamic type and value are preserved, but the interface type changes if compliant. (If the dynamic type does not satisfy interface <code class="code-styler-inline">T</code>, a panic occurs)</li>
</ol></div><div class="el-p"><p dir="auto">Narrowing an interface type can follow two paths:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> w io<span class="token punctuation">.</span>Writer</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">var</span> rw io<span class="token punctuation">.</span>ReadWriter</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">w <span class="token operator">=</span> rw <span class="token comment">// ok even if rw == nil</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">w <span class="token operator">=</span> rw<span class="token punctuation">.</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span>  <span class="token comment">// panic if rw == nil</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">To check the type, you can use the "ok" concept:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">f<span class="token punctuation">,</span> ok <span class="token operator">:=</span> w<span class="token punctuation">.</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>  <span class="token comment">// ok == true if assertion is successful</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">!Even in case of failure, <code class="code-styler-inline">f</code> will be cast but will receive the zero value of type <code class="code-styler-inline">T</code>.</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>As I understand it, type assertion can be used for expressions! (not just variables)</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>Type assertion with <code class="code-styler-inline">ok</code> is often used to determine a more specific error type.</p>
</blockquote></div><div class="el-p"><p dir="auto">Helper functions for correctly identifying an error type (which use type assertion with <code class="code-styler-inline">ok</code> under the hood):</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code class="code-styler-inline">os.IsExist(err error) bool</code></li>
<li data-line="1" dir="auto"><code class="code-styler-inline">os.IsNotExist</code></li>
<li data-line="2" dir="auto"><code class="code-styler-inline">os.IsPermission</code></li>
</ol></div><div class="el-p"><p dir="auto"><strong>VERY INTERESTING AND IMPORTANT</strong><br>
<code class="code-styler-inline">io.WriteString(w io.Writer, data string) (n int, err error)</code> — prints a string to an <code class="code-styler-inline">io.Writer</code> instead of converting to <code class="code-styler-inline">[]byte</code> with extra memory allocation that is immediately cleared. Use this function!<br>
Internally it uses an interesting trick:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">WriteString</span><span class="token punctuation">(</span>w io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> data <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">type</span> stringWriter <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">        <span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token keyword">if</span> sw<span class="token punctuation">,</span> ok <span class="token operator">:=</span> w<span class="token punctuation">.</span><span class="token punctuation">(</span>stringWriter<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>  <span class="token comment">// Again the ok-approach concept</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        <span class="token operator">&lt;</span>write <span class="token builtin">string</span> and <span class="token keyword">return</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    <span class="token operator">&lt;</span>write <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> and <span class="token keyword">return</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Usually, interfaces are used in two semantics:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">As concrete types, a specific action, where we simply don't care about the data.</li>
<li data-line="1" dir="auto">As a union of types to implement polymorphism.<br>
A convenient way to take the second path:</li>
</ol></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">switch</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// called a type switch</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token boolean">nil</span><span class="token punctuation">:</span> <span class="token operator">...</span>        <span class="token comment">// this branch matches a completely nil interface, i.e., x == nil</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">:</span> <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token builtin">string</span><span class="token punctuation">:</span> <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><strong>IMPORTANT:</strong> <code class="code-styler-inline">fallthrough</code> is not allowed here.</li>
</ul></div><div class="el-p"><p dir="auto">A more complex variant:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> x SomeInterfaceType</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">switch</span> x <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token builtin">bool</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">// here x has type bool</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">// here x has its interface type SomeInterfaceType</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token comment">// in nil and default cases, the type will also be the interface type!</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>An interface for a single type can be useful for decoupling packages when that type cannot reside in the same package.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>No need to go overboard with OOP; standalone functions and non-hidden types work perfectly!</p>
</blockquote></div><div class="el-h1"><h1 data-heading="Chapter 8: Goroutines and Channels" dir="auto" class="heading" id="Chapter_8_Goroutines_and_Channels_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 8: Goroutines and Channels</h1></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>The <code class="code-styler-inline">net</code> package provides tools for working with TCP, UDP, and Unix sockets.</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>The <code class="code-styler-inline">time</code> package provides tools for formatting and parsing time via layout (using an example!) and layout constants.</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span>  <span class="token comment">// arguments are evaluated before the goroutine starts</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Channels are a reference type.</p></div><div class="el-p"><p dir="auto">You can receive without using the value:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token operator">&lt;-</span>ch</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Channels are closed using the built-in function:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Sending to a closed channel — panic.</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Receiving from a closed channel — default zero value of the type.</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>Closing a closed or nil channel — panic.</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>Sending/receiving from a nil channel — permanent block.</li>
</ul></div><div class="el-p"><p dir="auto">Checking a receive from an exhausted channel:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">el<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch  <span class="token comment">// ok == false if zero value of type was received because channel closed</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Types of channels:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Unbuffered</li>
</ol></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> T<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ol"><ol start="2">
<li data-line="0" dir="auto">Buffered</li>
</ol></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> T<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// capacity = 3</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The length and capacity of a buffered channel can be retrieved:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">len</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token function">cap</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Cool pattern: <strong>Pipeline</strong><br>
in -&gt; [ch0] -&gt; goroutine1 -&gt; [ch1] -&gt; goroutine2 -&gt; [ch2] -&gt; goroutine3 -&gt; and so on … -&gt; out<br>
In this situation, you can use <code class="code-styler-inline">close(ch0)</code> so subsequent goroutines in the chain can handle this fact and close other channels in order.</p></div><div class="el-p"><p dir="auto">Iterating over a channel:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">for</span> el <span class="token operator">:=</span> <span class="token keyword">range</span> ch<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token operator">&lt;</span>do something with el<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>It is not mandatory to close channels (unlike files, connections, etc.).</p>
</blockquote></div><div class="el-p"><p dir="auto">Unidirectional channels:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">out <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span>  <span class="token comment">// write only; may be closed</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span>  <span class="token comment">// read only; close() on such a channel causes a compilation error</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Conversion from bidirectional to unidirectional is possible, but not vice versa!</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>Do not use buffered channels as queues! You might hit a deadlock.</p>
</blockquote></div><div class="el-p"><p dir="auto">IMPORTANT: if some goroutines try to write to a channel that has reached capacity and no one attempts to read, a <strong><em>goroutine leak</em></strong> occurs. Such situations are not handled by the garbage collector!</p></div><div class="el-p"><p dir="auto">Again on goroutine leaks: for example, if a channel is used to pass errors and we eject from the reading goroutine after the first error, the remaining reads won't execute and parallel goroutines will hang resources (a goroutine leak occurs!).</p></div><div class="el-p"><p dir="auto">Completely independent tasks are called <em>embarrassingly parallel</em>.</p></div><div class="el-p"><p dir="auto">Thread-safe goroutine counter:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">sync<span class="token punctuation">.</span>WaitGroup</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Usage (idiomatic pattern for parallel loop execution):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">for</span> <span class="token operator">&lt;</span><span class="token operator">...</span><span class="token operator">&gt;</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        <span class="token operator">&lt;</span>write any to channel<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// if run in the main goroutine, channel reading won't happen and wg.Wait() will hang</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    <span class="token operator">&lt;</span><span class="token builtin">close</span> channel<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text"><span class="token keyword">for</span> <span class="token operator">&lt;</span><span class="token operator">...</span><span class="token operator">&gt;</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    <span class="token operator">&lt;</span>read channel<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">There is a problem of excessive parallelism. It can be solved by semaphores:</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>Buffered channels can be used as a semaphore! The channel's capacity is the semaphore's capacity. We simply write to the channel to acquire a token (hanging until space is available) and read from it to release.<br>
Example:</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> sem <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">// Semaphore depth 20; cannot use := here at package level!</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    sem <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// take sem mutex</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">&lt;-</span>sem<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token operator">&lt;</span>do something safe synchronized<span class="token operator">!</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Another solution is reusing several long-lived goroutines:</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>You can start n goroutines reading from one channel and "feed" tasks from the main goroutine. This way we have at most 20 simultaneous jobs (perhaps HTTP connections).</p>
</blockquote></div><div class="el-p"><p dir="auto">The problem of a non-terminating program can be solved with a simple single-threaded counter (in the main goroutine).</p></div><div class="el-p"><p dir="auto">Channel receiving messages periodically (starts a goroutine):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">tick <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>period time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token comment">// returns channel of time moments &lt;-chan time.Time</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Channel receiving a value after a time interval (starts a goroutine):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">event_ch <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>period<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Importantly, <code class="code-styler-inline">time.Tick</code> can cause a goroutine leak, so if the timer isn't needed for the entire program, it's better to use the following template:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">ticker <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTicker</span><span class="token punctuation">(</span>period time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">&lt;-</span>ticker<span class="token punctuation">.</span>C</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">ticker<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Channel Multiplexing:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">select</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch1<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">        <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token keyword">case</span> x <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch2<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token keyword">case</span> ch3 <span class="token operator">&lt;-</span> y<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">        <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    <span class="token keyword">default</span><span class="token punctuation">:</span>  <span class="token comment">// without this block, the select{...} call is blocking!</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">        <span class="token operator">...</span><span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>waits for one of the communications and, upon readiness, performs the communication operation and the case block (without executing the others)</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>select {} waits forever</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>If multiple communications are ready, select picks one at random — this guarantees that each has an equal chance of being selected and processed.</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>can be interrupted by break</li>
</ul></div><div class="el-p"><p dir="auto">There is a convenient idiom with nil-channels: they can be considered "disabled" in multiplexing. Here is an example showing the ability to "turn off" logging in a summation goroutine. "Turning off" means that reading and writing will never be linked in the select{...} construct.<br>
Also, here is an example of a label:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> tick <span class="token operator">&lt;-</span><span class="token keyword">chan</span> time<span class="token punctuation">.</span>Time  <span class="token comment">// == nil (!)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">if</span> logging<span class="token punctuation">{</span>tick <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">loop<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token keyword">for</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        <span class="token keyword">select</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">            <span class="token keyword">case</span> el<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>values<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">                <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span><span class="token keyword">break</span> loop<span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">                sum <span class="token operator">+=</span> el</div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">            <span class="token keyword">case</span> <span class="token operator">&lt;-</span> tick<span class="token punctuation">:</span>  <span class="token comment">// this spot is "turned off" if !logging</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">                <span class="token function">printlog</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><strong>IMPORTANT</strong>:<br>
The broadcasting mechanism for notifying many goroutines is implemented simply — by closing an <code class="code-styler-inline">abort</code> channel!</p></div><div class="el-p"><p dir="auto">It is important that cancellation is a subtle concept, and sometimes many places in the code must be changed to make cancellation instantaneous; one should think carefully about where to invoke such logic.<br>
There is also a trick to verify that all goroutines terminate without leaking:</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>call panic() at the end of main() and see if there are any goroutines in the dump besides the main one!</p>
</blockquote></div><div class="el-p"><p dir="auto">Regularly performing select{} to see if there is a value or to go to default is called <em>polling</em> a channel.</p></div><div class="el-p"><p dir="auto">Interesting technique:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> client <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">clients <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> client<span class="token punctuation">)</span> <span class="token comment">// this is a channel of channels :)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Wow, how simple, beautiful, and elegant (abstract) a chat is implemented in Go. I can't help but leave a note here of my deepest admiration 😍🤤😭😍</p></div><div class="el-h1"><h1 data-heading="Chapter 9: Concurrency and Shared Data" dir="auto" class="heading" id="Chapter_9_Concurrency_and_Shared_Data_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 9: Concurrency and Shared Data</h1></div><div class="el-p"><p dir="auto">Concurrency issues:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">deadlocks — mutual acquisition of mutexes in the wrong order and their infinite hang</li>
<li data-line="1" dir="auto">livelocks — "looping" in a changing but uselessly repeating state</li>
<li data-line="2" dir="auto">starvation — lack of resources for a thread because everything is occupied by other threads</li>
</ol></div><div class="el-p"><p dir="auto">A treacherous example of unsynchronized access:<br>
Two clients write simultaneously — but only the first one's entry is recorded. Swallowing!</p></div><div class="el-p"><p dir="auto">Another ultra-treacherous example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> x <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">x<span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Here x can turn into a chimera: have a length of 100 but a base array of length 10, and writing the two will overwrite distant memory and lead to completely <em>undefined behavior</em>!</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>There is NO such thing as a benign data race! (Even if you are willing to compromise on something)</p>
</blockquote></div><div class="el-p"><p dir="auto">Ways to avoid a data race:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">do not write to the variable. For example, if a map is populated during initialization (before main starts), reading it from multiple goroutines is safe.</li>
<li data-line="1" dir="auto">Ensure that access to the variable is only from one goroutine. This goroutine acts as a broker for requests from other goroutines and is called a Monitor in this case (coroutine-management pattern).</li>
<li data-line="2" dir="auto">mutexes</li>
</ol></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>By convention, variables protected by a mutex are declared immediately after it.</li>
</ul></div><div class="el-p"><p dir="auto">RWMutex:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>RWMutex</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">mu<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">mu<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Do not succumb to the temptation of reading without an R-mutex because:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Firstly, a read operation should not be performed in the middle of other operations (writes).</li>
<li data-line="1" dir="auto">Secondly, locks and channels flush the cache of an individual core to shared memory, making results visible to other processes!! This is very important.</li>
</ol></div><div class="el-p"><p dir="auto">Sometimes the initialization of huge structures is deferred until their first use to avoid slowing down program startup; doing this in a thread-safe way is difficult. Here is an example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    mu sync<span class="token punctuation">.</span>RWMutex</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    bd BigData</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">BD</span><span class="token punctuation">(</span>args Args<span class="token punctuation">)</span> BigData<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    mu<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    <span class="token keyword">if</span> bd <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">        res <span class="token operator">:=</span> <span class="token operator">&lt;</span>get needed data from bd by args<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">        mu<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">        <span class="token keyword">return</span> res</div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    mu<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">        <span class="token comment">// dangerous place</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">    mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">    <span class="token keyword">if</span> bd <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>  <span class="token comment">// This check is needed because of the dangerous place</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text">        <span class="token function">initBD</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">    res <span class="token operator">:=</span> <span class="token operator">&lt;</span>get needed data from bd by args<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">    mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">    <span class="token keyword">return</span> res</div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">initBD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text">    <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The code is very large and contains a "dangerous place." Instead, the following is suggested:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> loadBDOnce sync<span class="token punctuation">.</span>Once</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">var</span> bd BigData</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">BD</span><span class="token punctuation">(</span>args Args<span class="token punctuation">)</span> BigData <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    loadBDOnce<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>initBD<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token keyword">return</span> <span class="token operator">&lt;</span>get needed data from bd by args<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">initBD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Build flag for building a version of the application/test (build/run/test) that records:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>shared memory usage</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>goroutine info</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>synchronization point info</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> <span class="token operator">&lt;</span>cmd<span class="token operator">&gt;</span> <span class="token operator">-</span>race <span class="token operator">...</span> <span class="token comment">// the program will be slower, but this can save a lot of nerves in the future!</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>There is a suppression-of-repetition technique consisting of creating, instead of a result, some structure with a <code class="code-styler-inline">done</code> channel that allows waiting. New duplicate requests will see that the result is "on its way" and wait for its actual completion (the closing of the <code class="code-styler-inline">done</code> channel).</p>
</blockquote></div><div class="el-p"><p dir="auto">OS Threads:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>managed by the task scheduler (via kernel-level interrupts)</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>require many operations for context switching</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>have a fixed stack<br>
Go Threads (Goroutines):</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>managed by the Go <em>m:n scheduler</em> (m goroutines per n threads)</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>use an internal mechanism for switching (similar to async/await)</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span>have a dynamic stack</li>
</ul></div><div class="el-p"><p dir="auto">GOMAXPROCS — that very <em>n</em> in the Go scheduler. By default, it equals the number of CPU cores. Keep in mind that "this does not count" sleeping goroutines and system calls (I/O, files, networks)!</p></div><div class="el-p"><p dir="auto">Keep in mind: goroutines do not have identification (because programmers often abuse <em>thread-local storage</em>, an abstraction over mapping an ID to local data).</p></div><div class="el-h1"><h1 data-heading="Chapter 10: Packages and Go Tools" dir="auto" class="heading" id="Chapter_10_Packages_and_Go_Tools_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 10: Packages and Go Tools</h1></div><div class="el-p"><p dir="auto">Compilation in Go is faster than other languages because:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">explicit imports (no scan needed)</li>
<li data-line="1" dir="auto">dependencies form a directed acyclic graph (can be compiled separately and in parallel)</li>
<li data-line="2" dir="auto">binaries record exported information not only for the package but also its dependencies (reading one binary per imported package, without going beyond those boundaries)</li>
</ol></div><div class="el-p"><p dir="auto">Surprising fact:</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>In reality, the meaning of import expression strings is not determined. What is determined is how the Go tool interprets them. (If Google or Yandex use their own builders, all of this might work differently!)</p>
</blockquote></div><div class="el-p"><p dir="auto">For shared or published packages, the import path must be globally unique! By convention, it should start with the domain of the owning organization!</p></div><div class="el-p"><p dir="auto">Each package defines its own name:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">package</span> mypackagename</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>By convention, the package name should match the last part of its import path (but we understand this is not mandatory 😉)</p>
</blockquote></div><div class="el-p"><p dir="auto">Exceptions to the general rules for package names and import paths:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">main package</li>
<li data-line="1" dir="auto"><code class="code-styler-inline">_test</code> suffix for packages in <code class="code-styler-inline">*_test.go</code> files (such directories can define 2 packages)</li>
<li data-line="2" dir="auto"><code class="code-styler-inline">.v2</code> suffix for import paths (the package itself is named without this suffix)</li>
</ol></div><div class="el-p"><p dir="auto">Renaming an import:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token string">"crypto/rand"</span>       <span class="token comment">// available as rand</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    mrand <span class="token string">"math/rand"</span>   <span class="token comment">// available as mrand</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Blank import:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token boolean">_</span> <span class="token string">"image/png"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>sometimes necessary to trigger side effects of initialization expressions and init()</p>
</blockquote></div><div class="el-p"><p dir="auto">Examples of needing a blank import:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token boolean">_</span> <span class="token string">"image/png"</span>          <span class="token comment">// init() registers png format for image.Decode(in)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token boolean">_</span> <span class="token string">"github.com/lib/pq"</span>  <span class="token comment">// enable support for Postgres (append this db driver)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token boolean">_</span> <span class="token string">"archive/tar"</span>        <span class="token comment">// enable support for tar archive format</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">By default, all these formats are not included so the binary isn't bloated!</p></div><div class="el-p"><p dir="auto">Frequently used commands of the go tool:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-25 в 23.49.27.png" src="a9s/снимок-экрана-2024-10-25-в-23.49.27.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-25 в 23.49.27.png" src="a9s/снимок-экрана-2024-10-25-в-23.49.27.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Standalone tools:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>gofmt — file formatting</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>golint — checking file for linting</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>godoc — shows documentation in HTML; can be run for your files as <code class="code-styler-inline">godoc -http:8000</code>. Flags <code class="code-styler-inline">-analysis=type</code> and <code class="code-styler-inline">-analysis=pointer</code> add advanced analysis info.</li>
</ul></div><div class="el-p"><p dir="auto"><span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D43A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D442 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D443 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D434 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D43B TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2014"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>GOROOT — root directory of the Go distribution (best not to touch)</p></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">go env</code> outputs all significant variables, including default values. Here are a few more interesting ones:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>GOOS — target OS</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>GOARCH — processor architecture</li>
</ul></div><div class="el-p"><p dir="auto">(Information may be outdated and requires clarification and a changelog check)…<br>
Command for installing source code and its dependencies:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> get domain<span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span><span class="token keyword">package</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">OR</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">go</span> get domain<span class="token operator">/</span>subtree<span class="token operator">/</span><span class="token operator">...</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>downloads packages, installs libraries and modules</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>supports popular code hosting sites</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>directories created by the program are full-fledged repository clients</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>flag <code class="code-styler-inline">-u</code> updates visited packages (including dependencies) to the latest version before installation</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> build args</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>compiles all packages from args</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>if called for the <code class="code-styler-inline">main</code> package, compiles the executable in the current directory</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>available forms: <code class="code-styler-inline">go build</code>; <code class="code-styler-inline">go build ./path/to/pack</code>; <code class="code-styler-inline">go build ../path/to/pack</code>; <code class="code-styler-inline">go build /path/to/pack</code></li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>flag <code class="code-styler-inline">-i</code> — installs dependencies</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>how to compile for another system: <code class="code-styler-inline">$GOOS=&lt;...&gt; go build ...</code></li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>for files with prefixes like <code class="code-styler-inline">net_linux*.go</code>, it compiles for that system</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Comments for the linker can be included in files:
<ul class="has-list-bullet">
<li data-line="7" dir="auto"><span class="list-bullet"></span>// +build linux darwin</li>
<li data-line="8" dir="auto"><span class="list-bullet"></span>// +build ignore</li>
<li data-line="9" dir="auto"><span class="list-bullet"></span>and others.</li>
</ul>
</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> install args</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>compiles all packages and executable programs from args and saves them in ?/pkg and ?/bin respectively</li>
</ul></div><div class="el-blockquote"><blockquote dir="auto">
<p>Doc-comments are specified at the beginning of the package and for all exported names.</p>
</blockquote></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>package comments should be in only one file. For large ones, this is usually doc.go</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> doc args</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>shows the doc from comments for a package or its member</li>
</ul></div><div class="el-blockquote"><blockquote dir="auto">
<p>There are internal packages if their path contains an <code class="code-styler-inline">internal</code> directory and they reside in a subtree. Such packages can access non-exported names.</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> list</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">Forms<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">go</span> list some<span class="token operator">/</span><span class="token keyword">package</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token keyword">go</span> list <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token keyword">go</span> list some<span class="token operator">/</span><span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token keyword">go</span> list <span class="token operator">...</span>xml<span class="token operator">...</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>outputs information about available packages</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>flag <code class="code-styler-inline">-f</code> «pattern string» allows writing a text/template language template for filtering</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> tool <span class="token operator">&lt;</span>cmd<span class="token operator">&gt;</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>runs one of the executable files of the Go tool, for example <code class="code-styler-inline">go tool cover</code> for information, or <code class="code-styler-inline">go tool cover -html=c.out</code> to process coverage profile results after testing</li>
</ul></div><div class="el-h1"><h1 data-heading="Chapter 11: Testing" dir="auto" class="heading" id="Chapter_11_Testing_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 11: Testing</h1></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">*_test.go</code> files are not part of the package via <code class="code-styler-inline">go build</code>, but they are part of it via <code class="code-styler-inline">go test</code>.<br>
There are three types of functions in such files:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><span style="color:#0ff0ff;">func Test&lt;&gt;  (t *testing.T) {…}</span></li>
<li data-line="1" dir="auto"><span style="color:#0ff0ff;"><b>func Benchmark&lt;&gt; (b *testing.B) {…}</b></span></li>
<li data-line="2" dir="auto"><span style="color:#0ff0ff;"><b>func Example&lt;&gt; () {…}</b></span></li>
</ol></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> test</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ol"><ol start="4">
<li data-line="0" dir="auto">looks for these functions</li>
<li data-line="1" dir="auto">builds a temporary package</li>
<li data-line="2" dir="auto">builds and runs it</li>
<li data-line="3" dir="auto">outputs results</li>
<li data-line="4" dir="auto">performs cleanup<br>
flags:</li>
</ol></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>-v, verbose</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>-run=«myregexp», runs only those tests whose names match the regex</li>
</ul></div><div class="el-p"><p dir="auto"><span style="color:#11ff11ff;">TEST</span></p></div><div class="el-p"><p dir="auto">Methods of t *testing.T:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">t<span class="token punctuation">.</span>Error</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">t<span class="token punctuation">.</span>Errorf</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">t<span class="token punctuation">.</span>Log</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">t<span class="token punctuation">.</span>Logf</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">t<span class="token punctuation">.</span>Fatal  <span class="token comment">// must be called from the same goroutine</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">t<span class="token punctuation">.</span>Fatalf  <span class="token comment">// and this one</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Table-driven testing with <code class="code-styler-inline">struct{input T; want P}</code> is common.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>the <code class="code-styler-inline">main</code> package can be tested just like any other, as if it were a library. In this case, the <code class="code-styler-inline">main()</code> function is ignored.</p>
</blockquote></div><div class="el-p"><p dir="auto">Package for sending emails: <code class="code-styler-inline">net/smtp</code></p></div><div class="el-blockquote"><blockquote dir="auto">
<p>When white-box testing, you can save original globals in the test and replace them with stubs, but they must be restored via <code class="code-styler-inline">defer</code> so that other tests don't see the substitution. Usually, <code class="code-styler-inline">go test</code> runs tests sequentially.</p>
</blockquote></div><div class="el-p"><p dir="auto">You can declare packages like</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">package</span> url_test</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">As part of <code class="code-styler-inline">net/url</code>. Then during the testing of <code class="code-styler-inline">net/url</code>, <code class="code-styler-inline">go test</code> will assemble an additional package <code class="code-styler-inline">url_test</code> and run its tests as well.<br>
This is called an <em>external test package</em>.</p></div><div class="el-p"><p dir="auto">Filtering files of the <code class="code-styler-inline">fmt</code> package:</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">work code</th>
<th dir="ltr">go list -f="{{.GoFiles}}" fmt</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr">tests of current package</td>
<td dir="ltr">go list -f="{{.TestGoFiles}}" fmt</td>
</tr>
<tr>
<td dir="ltr">external tests</td>
<td dir="ltr">go list -f="{{.XTestGoFiles}}" fmt</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">To allow an external test access to non-exported package names, a file <code class="code-styler-inline">export_test.go</code> is usually added to the regular tests, in which internal names are forwarded, for example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">//mainpack/export_test.go</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">package</span> mainpack</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">var</span> NowPublic <span class="token operator">=</span> wasPrivate</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">And the external testing package can gain access:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">//mainpack/xtest_test.go</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">package</span> mainpack_test</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token string">"mainpack"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">mainpack<span class="token punctuation">.</span>NowPublic  <span class="token comment">// access to private wasPrivate</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Avoid brittle tests! Do not test complex internal functions, or test something that obviously will never change in them.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>The degree to which tests investigate a package is called test <em>coverage</em>.<br>
Usually, you can see the <em>statement coverage</em>:</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>coverprofile<span class="token operator">=</span>c<span class="token punctuation">.</span>out mypack</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">OR</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>covermode<span class="token operator">=</span>count  <span class="token comment">// additionally counts the most covered (frequent) sections</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">OR</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>cover  <span class="token comment">// result only without profile</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><span style="color:#15ff35ff;">BENCHMARK</span><br>
Methods are the same as <code class="code-styler-inline">testing.T</code>, plus:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">b<span class="token punctuation">.</span>N  <span class="token comment">// iteration count field</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>timer management methods<span class="token operator">&gt;</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Running a benchmark:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>bench<span class="token operator">=</span><span class="token punctuation">.</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code class="code-styler-inline">bench</code> sets a regex. Necessary! Otherwise, nothing will be selected.</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>flag <code class="code-styler-inline">-benchmem</code> adds memory information to the output (number of allocations and total volume)</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>initially runs for small N, extrapolating to necessary ones</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>we usually write the loop ourselves, so we have the opportunity to initialize anything outside the loop. If this is still needed, the <code class="code-styler-inline">b</code> object allows regulating the testing core's timer.
<blockquote dir="auto">
<p>Benchmarks show absolute values. Calculating relative values is achieved by normal coding.</p>
</blockquote>
</li>
</ul></div><div class="el-p"><p dir="auto">Profiling is built into <code class="code-styler-inline">go test</code>. Here are the flags:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>-cpuprofile=cpu.out</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>-blockprofile=block.out</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>-memprofile=mem.out<br>
Do not use several flags at once, as some may distort the results of others.<br>
A test run does not delete the binary after a benchmark test but saves it as <code class="code-styler-inline">pack.test</code>.</li>
</ul></div><div class="el-p"><p dir="auto">Profiling tool for long-running applications:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> tool pprof</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Example of starting profiling:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>run<span class="token operator">=</span>NONE <span class="token operator">-</span>bench<span class="token operator">=</span>TargetFunction <span class="token operator">-</span>cpuprofile<span class="token operator">=</span>cpu<span class="token punctuation">.</span>out some<span class="token operator">/</span><span class="token keyword">package</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">And viewing it:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> tool pprof <span class="token operator">-</span>text <span class="token operator">-</span>nodecount<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">&lt;</span>binary<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">/</span>pack<span class="token punctuation">.</span>test <span class="token operator">&lt;</span>event log<span class="token operator">&gt;</span>cpu<span class="token punctuation">.</span>out</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">See also the visualization tool: graphviz</p></div><div class="el-p"><p dir="auto"><span style="color:#11ff11ff;">EXAMPLE</span></p></div><div class="el-p"><p dir="auto">Needed for:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>documentation</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>a runnable test for compliance with the output shown in the comment <code class="code-styler-inline">// Output:</code></li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>for practical snippets on godoc (<a data-tooltip-position="top" aria-label="http://golang.org" rel="noopener nofollow" class="external-link is-unresolved" href="http://golang.org" target="_self">golang.org</a>)</li>
</ul></div><div class="el-h1"><h1 data-heading="Chapter 12: Reflection" dir="auto" class="heading" id="Chapter_12_Reflection_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 12: Reflection</h1></div><div class="el-p"><p dir="auto"><span style="color:#30ffffff;">Common Methods</span></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span>tp reflect<span class="token punctuation">.</span>Type<span class="token punctuation">)</span>  <span class="token comment">// zero value for type tp</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> item<span class="token punctuation">)</span>  <span class="token comment">// slice — slice as reflect.Value, item — element as reflect.Value</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>tp<span class="token punctuation">)</span>  <span class="token comment">// new pointer to a variable of type tp reflect.Type</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">MakeMap</span><span class="token punctuation">(</span>tp<span class="token punctuation">)</span>  <span class="token comment">// create map of tp reflect.Type (where both key and value types are specified)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token comment">// deep recursive comparison across all corresponding elements</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token comment">// note (on the logic of this function): []int != []int{};   map[int]int != make(map[int]int)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><span style="color:#34ffffff;">Dynamic Type</span></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span>Type <span class="token comment">// dynamically represents a Go type</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Obtaining:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment">// returns reflect.Type</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Methods:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">t<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">t<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>ind<span class="token punctuation">)</span> reflect<span class="token punctuation">.</span>StructField  <span class="token comment">// struct field, for which one can ask, e.g., for .Name</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><span style="color:#30ffffff;">Dynamic Value</span></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span>Value <span class="token comment">// dynamically represents a value (of any type) in memory</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Obtaining:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment">// returns reflect.Value</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Methods:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// returns interface{} storing the correct type and value, back from reflect.Value</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// returns a description like "&lt;int Value&gt;". Note: NOT the string representation of the value</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// variety of the type. For named types, it "reaches" the underlying base type!</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// dynamic type.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token comment">// Obtaining values (panics if the real type doesn't match):</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Uint</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// (?) value where the reference type points</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>ind<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">NumField</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token comment">// struct field</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">FieldByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token comment">// get struct field by name</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">MapKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// slice of map keys []reflect.Value</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">MapIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">SetMapIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>  <span class="token comment">// map element assignment</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">IsNil</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// for pointers and interfaces</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// retrieve the dynamic value pointed to or the dynamic value of an interface type, </span></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text"><span class="token comment">// can then call .Type() to find the interface's type; for nil, this will be Invalid</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">CanAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// whether the value is addressable</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">27</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">CanSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// whether the value is both addressable and settable</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">28</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">29</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// check that the value is not zero/nil, actually represents something</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">30</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">31</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">NumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// number of methods of this interface value</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">32</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token comment">// getting the i-th method (attention: it will be bounded)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">33</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>    <span class="token comment">// ability to call the method</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Types have varieties (a-la type of the type):</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Bool, String, Int, Int8, …        — primitives</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Array, Struct                     — composite</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>Ptr, Slice, Map, Func, Chan       — reference</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>Interface                         — interface</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>Invalid                           — nil<br>
All Kind constants are presented in the <code class="code-styler-inline">reflect</code> package.</li>
</ul></div><div class="el-blockquote"><blockquote dir="auto">
<p>Important: I found out that the reflection tool indeed stores extra info, but through special mechanisms, so there isn't a huge overhead for every single variable's type. If reflection is not used at all, no extra data will be created!)</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>Reflection — has access to unexported fields!</p>
</blockquote></div><div class="el-p"><p dir="auto">Changes using reflection.</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>Reminder: there are variables (addressable locations in memory) and just values</p>
</blockquote></div><div class="el-p"><p dir="auto">It's not all that obvious here. Example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">x <span class="token operator">:=</span> <span class="token number">2</span>                   <span class="token comment">// value   type    variable?</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">a <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>  <span class="token comment">// 7       int     no</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">b <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">// 2       int     no</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">c <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span> <span class="token comment">// &amp;x      *int    no</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">d <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">// 2       int     yes</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">❗️General approach to getting an addressable <code class="code-styler-inline">reflect.Value</code>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// x -&gt; addressable representation of x as reflect.Value</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Another example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token comment">// addressable</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">❗️Obtaining the variable back from an addressable <code class="code-styler-inline">v reflect.Value</code> (example for int):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">ptr <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token function">Addr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token number">7</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">You can set the value of an <strong>addressable</strong> <code class="code-styler-inline">v reflect.Value</code>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// important to set using a reflect.Value</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>usually the same assignability checks as the compiler's are performed! So you can't write an int64 into an int.<br>
There are specialized analogs:</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">SetInt<span class="token punctuation">,</span> SetUint<span class="token punctuation">,</span> SetString<span class="token punctuation">,</span> SetFloat<span class="token punctuation">,</span> etc<span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token comment">// you can pass them a simple value without wrapping in reflect.Value</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// also does not do strict checks and can silently truncate int64 to int16, for example</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">These specialized methods can only be called for dynamic values of primitives, but <strong>NOT interfaces</strong>!</p></div><div class="el-p"><p dir="auto">For an interface, you can call <code class="code-styler-inline">.Set()</code>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> anyVar <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">v <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>anyVar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// anyVar=2. reminder that .Set() takes a reflect.Value!</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">v<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span>  <span class="token comment">// anyVar="hi"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p><strong>IMPORTANT</strong>: Setting the value of an unexported field still won't work! An addressable <code class="code-styler-inline">reflect.Value</code> records whether it was obtained by traversing an unexported struct field, and if so — prohibits modification!</p>
</blockquote></div><div class="el-p"><p dir="auto">Lexical analyzer:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"text/scanner"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Way to get struct field tags:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// v — reflect.Value addressable struct</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">tag <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>Tag  <span class="token comment">// tag</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">tag<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span>  <span class="token comment">// value by key in the tag</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Why reflection should be used cautiously:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">code is vulnerable as type errors are not checked by the compiler</li>
<li data-line="1" dir="auto">difficult code, expected types etc. must be clearly documented</li>
<li data-line="2" dir="auto">slow code. Often not a big deal for testing</li>
</ol></div><div class="el-h1"><h1 data-heading="Chapter 13: Low-Level Programming" dir="auto" class="heading" id="Chapter_13_Low-Level_Programming_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 13: Low-Level Programming</h1></div><div class="el-p"><p dir="auto">Interesting: the Go scheduler can freely move one goroutine between different OS threads.</p></div><div class="el-p"><p dir="auto">Important: the garbage collector can move a variable, changing its address! (which is why pointers do not reveal them)</p></div><div class="el-p"><p dir="auto">Package of low-level capabilities:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">unsafe</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>  <span class="token comment">// size of the representation of arg in bytes</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>expression <code class="code-styler-inline">arg</code> is not evaluated</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>result is of type <code class="code-styler-inline">const uintptr</code>, so it can be used in array sizes and defining other constants</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>reports the size of the fixed part of <code class="code-styler-inline">arg</code>, but not its contents</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>size of a composite type may be larger than the sum of its elements' sizes due to memory alignment (presence of alignment padding)</li>
</ul></div><div class="el-p"><p dir="auto">Base sizes:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-27 в 23.12.07.png" src="a9s/снимок-экрана-2024-10-27-в-23.12.07.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-27 в 23.12.07.png" src="a9s/снимок-экрана-2024-10-27-в-23.12.07.png" target="_self"></span></p></div><div class="el-blockquote"><blockquote dir="auto">
<p>Compilers can (though not observed yet) reorder struct fields.<br>
Generally, the most compact packing of a struct allows it to occupy less memory (in machine words) and thus be faster.</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>  <span class="token comment">// alignment size of arg</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">As a rule:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>booleans and numerics — by their size</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>others — by machine word size</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">unsafe<span class="token punctuation">.</span><span class="token function">Offsetof</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>f<span class="token punctuation">)</span>  <span class="token comment">// offset of part f relative to the start of data x</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>accounting for padding, if any</li>
</ul></div><div class="el-p"><p dir="auto">Example of padding in a struct:</p></div><div class="el-p"><p dir="auto"><span alt="Снимок экрана 2024-10-27 в 23.24.58.png" src="a9s/снимок-экрана-2024-10-27-в-23.24.58.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Снимок экрана 2024-10-27 в 23.24.58.png" src="a9s/снимок-экрана-2024-10-27-в-23.24.58.png" target="_self"></span></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">unsafe<span class="token punctuation">.</span>Pointer</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>a pointer, but without a specific type</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>can be obtained from a regular pointer <code class="code-styler-inline">*T</code> as <code class="code-styler-inline">unsafe.Pointer(&amp;x)</code></li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>can be turned back into a regular pointer as <code class="code-styler-inline">(*int)up</code>  // up is unsafe.Pointer</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>for arithmetic: can be converted to <code class="code-styler-inline">uintptr</code>: <code class="code-styler-inline">uintptr(up)</code></li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>can go back (dangerous!): <code class="code-styler-inline">unsafe.Pointer(uip)</code>  // uip is uintptr</li>
</ul></div><div class="el-p"><p dir="auto"><strong>IMPORTANT:</strong></p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>it is dangerous to break pointer expressions across different lines because <em>moving</em> garbage collectors change addresses of pointers and <code class="code-styler-inline">unsafe.Pointer</code>, but not <code class="code-styler-inline">uintptr</code> (which is a simple number). If we save <code class="code-styler-inline">uip</code> in one instruction to return to it later, it might already point to an arbitrary area!</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Even funnier, if <code class="code-styler-inline">uip</code> is the only address of some variable and there are no other pointers, the garbage collector might simply destroy the variable before we try to access it via that address.</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>Even if the garbage collector is not a moving one, the address might change during a goroutine stack rebuild...
<blockquote dir="auto">
<p>Therefore, for example, all pointers returned by the <code class="code-styler-inline">reflect</code> package as <code class="code-styler-inline">uintptr</code> should be immediately converted to <code class="code-styler-inline">unsafe.Pointer</code>.</p>
</blockquote>
</li>
</ul></div><div class="el-p"><p dir="auto">In Go, you can call C code. To do this, a special comment is inserted and the "package" "C" is imported:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">package</span> bzip</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">/*</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token comment">#cgo CFLAGS: -I/usr/include</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">#cgo LDFLAGS: -L/usr/lib -lbz2</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token comment">#cgo ... and other directives for the cgo tool</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token comment">C code</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token comment">*/</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"C"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token operator">...</span> Go code with the ability to access C language fields<span class="token punctuation">:</span> C<span class="token punctuation">.</span>field1<span class="token punctuation">,</span> C<span class="token punctuation">.</span>function<span class="token punctuation">,</span> C<span class="token punctuation">.</span>tp<span class="token punctuation">,</span> C<span class="token punctuation">.</span>CONST etc<span class="token punctuation">.</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>the declaration <code class="code-styler-inline">import "C"</code> forces <code class="code-styler-inline">go build</code> to pre-process this file with the <code class="code-styler-inline">cgo</code> tool, creating a temporary "C" package with Go declarations so the regular Go compiler can work correctly.</li>
</ul></div><div class="el-p"><p dir="auto">It is also possible to compile Go code as a static archive or dynlib for running in C programs.</p></div><div class="el-p"><p dir="auto">One must understand these are very complex matters not yet strictly defined. Here are the questions:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>memory management</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>pointers</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>callbacks</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>signal handling</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>strings</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>errno</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span>finalizers</li>
<li data-line="7" dir="auto"><span class="list-bullet"></span>relations between goroutines and OS threads</li>
<li data-line="8" dir="auto"><span class="list-bullet"></span>correct pointer passing</li>
<li data-line="9" dir="auto"><span class="list-bullet"></span>etc.<br>
see: <a rel="noopener nofollow" class="external-link is-unresolved" href="http://golang.org/cmd/cgo" target="_self">http://golang.org/cmd/cgo</a></li>
</ul></div><div class="el-h1"><h1 data-heading="Additional" dir="auto" class="heading" id="Additional_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Additional</h1></div><div class="el-blockquote"><blockquote dir="auto">
<p>Dot notation with a pointer to a struct automatically dereferences it!<br>
Dereferencing also happens when indexing a pointer to an array.</p>
</blockquote></div><div class="el-p"><p dir="auto">Anonymous struct fields:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> Struct1 <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    Field <span class="token builtin">int</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token keyword">type</span> Struct2 <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    Name <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    Struct1  <span class="token comment">// field has both type and name Struct1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Such a structure is called <strong>embedded</strong>, its fields can be accessed directly:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> s Struct2</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">s<span class="token punctuation">.</span>Field <span class="token operator">=</span> <span class="token operator">...</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Pointers only exist for what is stored in variables! You cannot take an address like this: <code class="code-styler-inline">&amp;4</code></p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>ok-approach:</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">val<span class="token punctuation">,</span> ok <span class="token operator">:=</span> mydict<span class="token punctuation">[</span>key<span class="token punctuation">]</span>  <span class="token comment">// ok — is key in mydict indeed?</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">typed<span class="token punctuation">,</span> ok <span class="token operator">:=</span> object<span class="token punctuation">.</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>  <span class="token comment">// ok — has object the type T?</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">el<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>channel  <span class="token comment">// ok — channel isn't closed?</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Switch:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">switch</span> <span class="token operator">&lt;</span>init optional<span class="token operator">!</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token operator">&lt;</span>expression optional<span class="token operator">!</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token operator">&lt;</span>val <span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">        <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        <span class="token keyword">fallthrough</span>  <span class="token comment">// go into next section</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token operator">&lt;</span>val <span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token keyword">case</span> <span class="token operator">&lt;</span>val <span class="token number">3</span><span class="token operator">&gt;</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">        <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    <span class="token keyword">default</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">        <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all is-collapsed" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#GoPL_0" data-path="#GoPL_0"><div class="tree-item-inner heading-link" heading-name="GoPL">GoPL</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_1_Tutorial_0" data-path="#Chapter_1_Tutorial_0"><div class="tree-item-inner heading-link" heading-name="Chapter 1: Tutorial">Chapter 1: Tutorial</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_2_Program_Structure_0" data-path="#Chapter_2_Program_Structure_0"><div class="tree-item-inner heading-link" heading-name="Chapter 2: Program Structure">Chapter 2: Program Structure</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_3_Basic_Types_0" data-path="#Chapter_3_Basic_Types_0"><div class="tree-item-inner heading-link" heading-name="Chapter 3: Basic Types">Chapter 3: Basic Types</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_4_Composite_Types_0" data-path="#Chapter_4_Composite_Types_0"><div class="tree-item-inner heading-link" heading-name="Chapter 4: Composite Types">Chapter 4: Composite Types</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_5_Functions_0" data-path="#Chapter_5_Functions_0"><div class="tree-item-inner heading-link" heading-name="Chapter 5: Functions">Chapter 5: Functions</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_6_Methods_0" data-path="#Chapter_6_Methods_0"><div class="tree-item-inner heading-link" heading-name="Chapter 6: Methods">Chapter 6: Methods</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_7_Interfaces_0" data-path="#Chapter_7_Interfaces_0"><div class="tree-item-inner heading-link" heading-name="Chapter 7: Interfaces">Chapter 7: Interfaces</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_8_Goroutines_and_Channels_0" data-path="#Chapter_8_Goroutines_and_Channels_0"><div class="tree-item-inner heading-link" heading-name="Chapter 8: Goroutines and Channels">Chapter 8: Goroutines and Channels</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_9_Concurrency_and_Shared_Data_0" data-path="#Chapter_9_Concurrency_and_Shared_Data_0"><div class="tree-item-inner heading-link" heading-name="Chapter 9: Concurrency and Shared Data">Chapter 9: Concurrency and Shared Data</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_10_Packages_and_Go_Tools_0" data-path="#Chapter_10_Packages_and_Go_Tools_0"><div class="tree-item-inner heading-link" heading-name="Chapter 10: Packages and Go Tools">Chapter 10: Packages and Go Tools</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_11_Testing_0" data-path="#Chapter_11_Testing_0"><div class="tree-item-inner heading-link" heading-name="Chapter 11: Testing">Chapter 11: Testing</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_12_Reflection_0" data-path="#Chapter_12_Reflection_0"><div class="tree-item-inner heading-link" heading-name="Chapter 12: Reflection">Chapter 12: Reflection</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Chapter_13_Low-Level_Programming_0" data-path="#Chapter_13_Low-Level_Programming_0"><div class="tree-item-inner heading-link" heading-name="Chapter 13: Low-Level Programming">Chapter 13: Low-Level Programming</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="gopl.html#Additional_0" data-path="#Additional_0"><div class="tree-item-inner heading-link" heading-name="Additional">Additional</div></a><div class="tree-item-children"></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>