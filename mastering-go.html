<!DOCTYPE html> <html lang="en"><head>
<title>Mastering Go</title>
<base href=".">
<meta name="pathname" content="mastering-go.html">
<meta name="description" content="Compendium - Mastering Go">
<meta property="og:title" content="Mastering Go">
<meta property="og:description" content="Compendium - Mastering Go">
<meta property="og:type" content="website">
<meta property="og:url" content="mastering-go.html">
<meta property="og:image" content="a9s/telegram-cloud-document-2-5312238323056530771.jpg">
<meta charset="UTF-8"><meta property="og:site_name" content="Compendium"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="preload" href="site-lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/snippets.css"></noscript><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/other-plugins.css"></noscript><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/supported-plugins.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager show-inline-title show-ribbon code-styler code-styler-style-inline code-styler-gutter-highlight is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles">mjx-c.mjx-c2200::before{padding:.694em .556em .022em 0;content:"∀"}mjx-c.mjx-c2283::before{padding:.54em .778em .04em 0;content:"⊃"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c222A::before{padding:.598em .667em .022em 0;content:"∪"}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c1D438.TEX-I::before{padding:.68em .764em 0 0;content:"E"}mjx-c.mjx-c2287::before{padding:.636em .778em .138em 0;content:"⊇"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"∗"}mjx-msup{display:inline-block;text-align:left}mjx-mn{display:inline-block;text-align:left}mjx-c.mjx-c5B::before{padding:.75em .278em .25em 0;content:"["}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"−"}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c5D::before{padding:.75em .278em .25em 0;content:"]"}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c1D453.TEX-I::before{padding:.705em .55em .205em 0;content:"f"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-c.mjx-c210E.TEX-I::before{padding:.694em .576em .011em 0;content:"h"}mjx-c.mjx-c1D464.TEX-I::before{padding:.443em .716em .011em 0;content:"w"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c1D466.TEX-I::before{padding:.442em .49em .205em 0;content:"y"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;font-size-adjust:none;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-texatom{display:inline-block;text-align:left}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("site-lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("site-lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("site-lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("site-lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("site-lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("site-lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("site-lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("site-lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("site-lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("site-lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("site-lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("site-lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("site-lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("site-lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("site-lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("site-lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("site-lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("site-lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("site-lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("site-lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("site-lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("site-lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c1D43A.TEX-I::before{padding:.705em .786em .022em 0;content:"G"}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c1D43B.TEX-I::before{padding:.683em .888em 0 0;content:"H"}mjx-c.mjx-c2014::before{padding:.285em 1em 0 0;content:"—"}</style><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="Mastering_Go_0">Mastering Go</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-p"><p dir="auto">This is my notes for the book:<br>
<strong>Mastering Go</strong> — <em>Mihalis Tsoukalos</em></p></div><div class="el-h1"><h1 data-heading="Chapter 1: Introduction" dir="auto" class="heading" id="Chapter_1_Introduction_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 1: Introduction</h1></div><div class="el-p"><p dir="auto">The <code class="code-styler-inline">cobra</code> and <code class="code-styler-inline">viper</code> libraries are used to create CLI applications.</p></div><div class="el-p"><p dir="auto">Go uses <u>static linking</u>! Thus, all dependencies (only the necessary ones) are bundled into the binary, making it independent.</p></div><div class="el-p"><p dir="auto">You can quickly get data from a user using:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded">fmt<span class="token punctuation">.</span><span class="token function">Scanln</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">string</span><span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">The following help to reach and identify the executable file:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded">os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span>varname <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>  <span class="token comment">// get env var</span>
filepath<span class="token punctuation">.</span><span class="token function">SplitList</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>  <span class="token comment">// cross-platform way to split paths</span>
filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>paths <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>  <span class="token comment">// join paths</span>
os<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>FileInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token comment">// info about file</span>
<span class="token punctuation">(</span>FileInfo<span class="token punctuation">)</span> <span class="token function">Mode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> FileMode  <span class="token comment">// describes file's mode</span>
<span class="token punctuation">(</span>FileMode<span class="token punctuation">)</span> <span class="token function">IsRegular</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token comment">// is it a regular file?</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Logging is intended for applications, not libraries!<br>
Creating a logger that writes to the system log <code class="code-styler-inline">/var/log/system.log</code>:</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go"><code data-line="0" class="language-go is-loaded">sysLog<span class="token punctuation">,</span> err <span class="token operator">:=</span> syslog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>syslog<span class="token punctuation">.</span>LOG_SYSLOG<span class="token punctuation">,</span> <span class="token string">"systemLog.go"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">SetOutput</span><span class="token punctuation">(</span>sysLog<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"&lt;print your messages&gt;"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">The logger defines:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token punctuation">.</span>Print<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span>ln<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// for logs</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token punctuation">.</span>Panic<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span>ln<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// for errors</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">.</span>Fatal<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span>ln<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// for critical crashes and immediate termination via os.Exit(1)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Creating your own log file in the <code class="code-styler-inline">/tmp</code> directory (for Mac this is <code class="code-styler-inline">/var/folders/…</code>):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">LOGFILE <span class="token operator">:=</span> path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">TempDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"mylog.log"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>LOGFILE<span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_APPEND<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_WRONLY<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token keyword">return</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">mylog <span class="token operator">:=</span> log<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"mylog: "</span><span class="token punctuation">,</span> log<span class="token punctuation">.</span>LstdFlags<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">mylog<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"&lt;print your messages&gt;"</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">You can change the flags argument for the <code class="code-styler-inline">log.New</code> function to output different data to the log (time, source code line, etc.):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">LstdFlags <span class="token operator">:=</span> log<span class="token punctuation">.</span>Ldate <span class="token operator">|</span> log<span class="token punctuation">.</span>Lshortfile  <span class="token comment">// my custom flags</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Flags can also be reset during the process:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">mylog<span class="token punctuation">.</span><span class="token function">SetFlags</span><span class="token punctuation">(</span>LstdFlags<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Generics are used like this:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> f<span class="token punctuation">[</span>T any<span class="token punctuation">]</span><span class="token punctuation">(</span>values <span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="Chapter 2: Basic Data Types" dir="auto" class="heading" id="Chapter_2_Basic_Data_Types_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 2: Basic Data Types</h1></div><div class="el-p"><p dir="auto">Getting an error:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> args<span class="token operator">...</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Go treats time and date as the same thing!</p></div><div class="el-p"><p dir="auto">Conversions are legitimate:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// but one must understand there could be decoding errors here</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Useful function:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">strings<span class="token punctuation">.</span><span class="token function">Fields</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>  <span class="token comment">// splits by \s+</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Using a time zone:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">loc<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">LoadLocation</span><span class="token punctuation">(</span><span class="token string">"America/New_York"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">mytime<span class="token punctuation">.</span><span class="token function">In</span><span class="token punctuation">(</span>loc<span class="token punctuation">)</span>  <span class="token comment">// returns time in the specified location</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">You can skip multiple constants:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">const</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    a <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">iota</span><span class="token operator">*</span><span class="token boolean">iota</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token boolean">_</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    b</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token boolean">_</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    c</div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token comment">// a = 0, b = 4, c = 16</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Holy cow. You can set the capacity of a sliced slice:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">newSlice <span class="token operator">:=</span> slice<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token comment">// resulting capacity equals 7-1 </span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// the specified capacity (7) must not exceed the capacity of the original slice</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Reminder: <code class="code-styler-inline">copy(dst, src)</code> is used for slices (or strings and <code class="code-styler-inline">[]byte</code>), and returns the number of copied elements, which equals <code class="code-styler-inline">min(len(dst), len(src))</code>.</p></div><div class="el-p"><p dir="auto">Reminder: sorting is implemented via interfaces, so for reverse order you need:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">sort<span class="token punctuation">.</span><span class="token function">Ints</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span>  <span class="token comment">// just sort ints</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">sort<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">IntSlice</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Cryptographically secure random:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"crypto/rand"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="Chapter 3: Composite Types" dir="auto" class="heading" id="Chapter_3_Composite_Types_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 3: Composite Types</h1></div><div class="el-p"><p dir="auto">Do not use <code class="code-styler-inline">new</code> with maps and channels!</p></div><div class="el-p"><p dir="auto">Reminder: a <code class="code-styler-inline">Must</code> prefix in a function name indicates that it will panic upon failure.</p></div><div class="el-p"><p dir="auto">Regex:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"regexp"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">re <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">re<span class="token punctuation">.</span><span class="token function">MatchString</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">CSV:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">lines<span class="token punctuation">,</span> err <span class="token operator">:=</span> csv<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">csvwriter <span class="token operator">:=</span> csv<span class="token punctuation">.</span><span class="token function">NewWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">csvwriter<span class="token punctuation">.</span>Comma <span class="token operator">=</span> <span class="token char">'\t'</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">err <span class="token operator">=</span> csvwriter<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">csvwriter<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="Chapter 4: Interfaces Reflection" dir="auto" class="heading" id="Chapter_4_Interfaces_Reflection_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 4: Interfaces Reflection</h1></div><div class="el-p"><p dir="auto">JSON unmarshaling can be performed into <code class="code-styler-inline">map[string]interface{}</code>, which allows for saving an arbitrary structure.</p></div><div class="el-h1"><h1 data-heading="Chapter 5: Go Packages and Functions" dir="auto" class="heading" id="Chapter_5_Go_Packages_and_Functions_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 5: Go Packages and Functions</h1></div><div class="el-p"><p dir="auto">Normal way to sort in a functional style:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">sort<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> lessfunc<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Checking if sorted is also supported:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">sort<span class="token punctuation">.</span><span class="token function">SliceIsSorted</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> lessfunc<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><strong>SUPER IMPORTANT:</strong><br>
You cannot pass a list with a concrete type, e.g., <code class="code-styler-inline">[]int</code>, as <code class="code-styler-inline">[]interface{}</code>.</p></div><div class="el-p"><p dir="auto">IMPORTANT:<br>
The new semantics for closures in loops does indeed slightly slow down the code by allocating variables on the heap instead of the stack, but the compiler only does this when the variable has its address taken <code class="code-styler-inline">&amp;i</code> or is used in a closure.</p></div><div class="el-p"><p dir="auto">Working with a Database:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">connection <span class="token operator">:=</span> <span class="token string">"host=localhost port=5432 user=postgres password=password dbname=products sslmode=disable"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token function">MustNil</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">`SELECT "datname" FROM "pg_database" WHERE datistemplate = false`</span><span class="token punctuation">)</span> <span class="token comment">// Cursor!</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token function">MustNil</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    <span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">        <span class="token keyword">var</span> result <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">        err <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">        <span class="token function">MustNil</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"&gt;"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Methods for an open connection:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">db<span class="token punctuation">.</span>Query  <span class="token comment">// with getting a response as a cursor</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">db<span class="token punctuation">.</span>Exec   <span class="token comment">// without getting a response</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Queries can be passed as:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token punctuation">(</span><span class="token string">`SELECT ...`</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token punctuation">(</span><span class="token string">`DELETE FROM ... WHERE "field" = $1`</span><span class="token punctuation">,</span> args<span class="token operator">...</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Query for selecting from 2 tables:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">SELECT</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token string">"id"</span><span class="token punctuation">,</span><span class="token string">"username"</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"surname"</span><span class="token punctuation">,</span><span class="token string">"description"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">FROM</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token string">"users"</span><span class="token punctuation">,</span><span class="token string">"userdata"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">WHERE</div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    users<span class="token punctuation">.</span>id <span class="token operator">=</span> userdata<span class="token punctuation">.</span>userid</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Query for updating records:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">UPDATE</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token string">"userdata"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">SET</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token string">"name"</span><span class="token operator">=</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"surname"</span><span class="token operator">=</span>$<span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"description"</span><span class="token operator">=</span>$<span class="token number">3</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">WHERE</div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token string">"userid"</span><span class="token operator">=</span>$<span class="token number">4</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Versions:<br>
v2.4.14, v.1.24.3, etc.<br>
General format:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">vX<span class="token punctuation">.</span>Y<span class="token punctuation">.</span>Z</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">X <span class="token punctuation">(</span>major<span class="token punctuation">)</span> — major version<span class="token punctuation">,</span> usually without backward compatibility</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">Y <span class="token punctuation">(</span>minor<span class="token punctuation">)</span> — <span class="token builtin">new</span> functionality</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">Z <span class="token punctuation">(</span>patch<span class="token punctuation">)</span> — bug fixes without <span class="token builtin">new</span> functionality</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">go doc</code> / <code class="code-styler-inline">godoc</code> treats comments specially:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// BUG(1): ...</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">A bit about CI/CD:</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>You can use GitLab Runners or GitHub Actions to define CI/CD scripts that can automatically build and run new code in a container (so you don't have to do it manually).</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>GitHub has its own "Secrets" storage where you can save <code class="code-styler-inline">uname</code>/<code class="code-styler-inline">pass</code> for postgres and/or docker.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>GitHub can automatically analyze, compile, and package new code into a docker container, which can then be automatically pushed to DockerHub.</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>DockerHub — a cloud container registry provided by Docker.</p>
</blockquote></div><div class="el-p"><p dir="auto">There is a way to manage Go package variables during build using a builder flag, as well as taking the version from a commit. Here is the combined command:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ export VERSION<span class="token operator">=</span>$<span class="token punctuation">(</span>git rev<span class="token operator">-</span>list <span class="token operator">-</span><span class="token number">1</span> HEAD<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">go</span> build <span class="token operator">-</span>ldflags <span class="token string">"-X main.VERSION=$VERSION"</span> gitVersion<span class="token punctuation">.</span><span class="token keyword">go</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">And here is the usage:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ <span class="token punctuation">.</span><span class="token operator">/</span>gitVersion version</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">Version<span class="token punctuation">:</span> 99745c8fbaff94790b5818edf55f15d309f5bfeb</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 6: Giving Instructions to The Unix System" dir="auto" class="heading" id="Chapter_6_Giving_Instructions_to_The_Unix_System_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 6: Giving Instructions to The Unix System</h1></div><div class="el-p"><p dir="auto">Stdin, Stdout, Stderr — 3 files constantly open in UNIX.<br>
UNIX uses file descriptors, and these 3 files are represented by the numbers 0, 1, and 2 respectively.<br>
They can be found at:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token operator">/</span>dev<span class="token operator">/</span>fd<span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">/</span>dev<span class="token operator">/</span>fd<span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">/</span>dev<span class="token operator">/</span>fd<span class="token operator">/</span><span class="token number">2</span> — respectively</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Processes are divided into 3 types:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">User processes</li>
<li data-line="1" dir="auto">Daemons</li>
<li data-line="2" dir="auto">Kernel processes</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>In UNIX, signals are used for asynchronous interaction with an application.</p>
</blockquote></div><div class="el-p"><p dir="auto">Get process ID:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">os<span class="token punctuation">.</span><span class="token function">Getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Predefined signal constants:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span>SIGINT <span class="token punctuation">(</span><span class="token operator">^</span>C<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span>SIGINFO</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span>SIGKILL</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span>SIGSTOP <span class="token punctuation">(</span><span class="token operator">^</span>Z<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span>SIGTERM</div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span>SIGURG</div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">and others</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">^D — sends the EOF command.</p></div><div class="el-p"><p dir="auto">Set your own channel for handling system signals:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"os"</span><span class="token punctuation">;</span> <span class="token string">"os/signal"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">signal<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> args<span class="token operator">...</span><span class="token punctuation">)</span>  <span class="token comment">// accepts a buffered channel of capacity 1: chan os.Signal</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// specific signal codes are passed in args if you only need to handle those</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">These signals cannot be intercepted:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span>SIGKILL<span class="token punctuation">;</span> syscall<span class="token punctuation">.</span>SIGSTOP</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Command to send a signal (default is -9) to a process:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">kill <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">&lt;</span>sigcode or signame<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Reference from an <span style="color:#ff39ffff;">AI</span> on what to use and what not to:</p></div><div class="el-pre code-styler-pre-parent"><pre class="code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">[file rw] use: os.ReadFile, os.WriteFile, os.Open, os.OpenFile, os.Create, bufio.NewReader,</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">               bufio.NewWriter, io.Copy</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">[file rw] DON'T: ioutil</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">[dir tree] use: filepath.WalkDir (represents elements as fs.DirEntry)</div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">[dir tree] DON'T: filepath.Walk</div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">[file stat] use: os.FileInfo, fs.ReadDir, fs.DirEntry, os.Stat, os.Lstat</div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">[file stat] DON'T: os.FileMode (for direct identification of file type)</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Funny: <code class="code-styler-inline">ReadDir</code> and <code class="code-styler-inline">DirEntry</code> were copied from Python :)</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>The <code class="code-styler-inline">io.Reader.Read([]byte)</code> method fills the slice according to its length (<code class="code-styler-inline">len</code>). Similarly for <code class="code-styler-inline">Writer</code>.</p>
</blockquote></div><div class="el-p"><p dir="auto">Basic interfaces for reading/writing data:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">io<span class="token punctuation">.</span>Reader</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">io<span class="token punctuation">.</span>Writer</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Buffering:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"bufio"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">SEPARATELY ON FILES (from <span style="color:#ff25ffff;">AI</span>):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">Open file <span class="token keyword">for</span> reading<span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">Read bytes<span class="token punctuation">:</span> f<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">Read buffered bytes<span class="token punctuation">:</span> bufio<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> r<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">Read buffered strings<span class="token punctuation">:</span> r<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">Read buffered strings in a loop<span class="token punctuation">:</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span> s<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> s<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">Read entirely<span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">Open <span class="token punctuation">(</span>overwrite<span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">Open <span class="token punctuation">(</span><span class="token builtin">append</span><span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">Write bytes<span class="token punctuation">:</span> f<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">Write formatted strings<span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Fprint</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">Write strings<span class="token punctuation">:</span> f<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">Write entirely<span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">Write buffered <span class="token function">bytes</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span><span class="token punctuation">:</span> bufio<span class="token punctuation">.</span><span class="token function">NewWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> w<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> w<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">Work with positions<span class="token punctuation">:</span> <span class="token string">`f.Seek()`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">Close a file<span class="token punctuation">:</span> <span class="token string">`f.Close()`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">Delete a file<span class="token punctuation">:</span> <span class="token string">`os.Remove()`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">Rename<span class="token operator">/</span>Move<span class="token punctuation">:</span> <span class="token string">`os.Rename()`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">Get info<span class="token punctuation">:</span> <span class="token string">`os.Stat()`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text">Change permissions<span class="token punctuation">:</span> <span class="token string">`os.Chmod()`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text">Change owner<span class="token punctuation">:</span> <span class="token string">`os.Chown()`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text">Change timings<span class="token punctuation">:</span> <span class="token string">`os.Chtimes()`</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">UNIX command to output the first lines (or <code class="code-styler-inline">-c</code> characters):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">head <span class="token operator">&lt;</span>flags<span class="token operator">&gt;</span> file</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Interesting fact: in UNIX, there are files that collect entropy and provide cryptographic randomness:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token operator">/</span>dev<span class="token operator">/</span>random <span class="token comment">// blocks if not enough entropy has been collected yet</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">/</span>dev<span class="token operator">/</span>urandom <span class="token comment">// non-blocking, but may have lower cryptographic strength</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">How to read random bytes from <code class="code-styler-inline">/dev/random</code> and decode them into, for example, <code class="code-styler-inline">int64</code>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"encoding/binary"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">file<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"/dev/random"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token keyword">var</span> rnd <span class="token builtin">int64</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">binary<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> binary<span class="token punctuation">.</span>LittleEndian<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rnd<span class="token punctuation">)</span>  <span class="token comment">// specified LittleEndian byte order</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Note: marshaling problems are often related to non-exported fields.</p>
</blockquote></div><div class="el-p"><p dir="auto">JSON tags once again:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token string">`json:"newname"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token string">`json:"newname,omitempty"`</span> <span class="token comment">// do not record nulls/zero values</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token string">`json:"-"`</span> <span class="token comment">// do not record at all</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">You can use <code class="code-styler-inline">json.Marshal()</code> and <code class="code-styler-inline">json.Unmarshal()</code> directly, or you can create streaming ones:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>You can set <code class="code-styler-inline">.SetIndent()</code> for these.</p>
</blockquote></div><div class="el-p"><p dir="auto">An analogous package exists for XML:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"encoding/xml"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">But the essence is slightly different; here is an example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> Employee <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    XMLName   xml<span class="token punctuation">.</span>Name <span class="token string">`xml:"employee"`</span> <span class="token comment">// needed as the element name</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    ID        <span class="token builtin">int</span>      <span class="token string">`xml:"id,attr"`</span> <span class="token comment">// attr is inside the tag: &lt;employee id=7&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    FirstName <span class="token builtin">string</span>   <span class="token string">`xml:"name&gt;first"`</span> <span class="token comment">// inner tag</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    LastName  <span class="token builtin">string</span>   <span class="token string">`xml:"name&gt;last"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    Height    <span class="token builtin">float32</span>  <span class="token string">`xml:"height,omitempty"`</span> <span class="token comment">// omit if empty</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    Address</div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    Comment <span class="token builtin">string</span> <span class="token string">`xml:",comment"`</span> <span class="token comment">// comment as is</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">A similar story exists for YAML, but it is noted that a third-party package must be installed for this.</p></div><div class="el-p"><p dir="auto">Application of <code class="code-styler-inline">viper</code> (schematically):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">pflag<span class="token punctuation">.</span><span class="token function">StringP</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>  <span class="token comment">// --someflag -s</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">pflag<span class="token punctuation">.</span><span class="token function">StringP</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">SetNormalizeFunc</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">pflag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">viper<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">val <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token comment">// 37 &lt;= --age 37</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">As I understand it, <code class="code-styler-inline">viper</code> is only needed for application configuration. That is, <code class="code-styler-inline">pflag</code> works with flags, while <code class="code-styler-inline">viper</code> acts as a settings manager.<br>
Here is an example of working with a config file:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">viper<span class="token punctuation">.</span><span class="token function">SetConfigFile</span><span class="token punctuation">(</span>CONFIG<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">IsSet</span><span class="token punctuation">(</span><span class="token string">"some_param"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token operator">&lt;</span>use<span class="token operator">&gt;</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">"some_param"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token comment">// You can unload the config into a structure:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token keyword">type</span> ConfigStructure <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    SomeParam   <span class="token builtin">int</span> <span class="token string">`mapstructure:"some_param"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token keyword">var</span> cnf ConfigStructure</div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token boolean">_</span> <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cnf<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">Cobra</code> is needed for creating a CLI interface. It comes both as a package and as a console utility for code generation.</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$cobra<span class="token operator">-</span>cli init$ cobra<span class="token operator">-</span>cli add foo</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">$cobra<span class="token operator">-</span>cli add bar$ cobra<span class="token operator">-</span>cli add subfoo <span class="token operator">-</span>p fooCmd</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Command and its description:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> subCmd <span class="token operator">=</span> <span class="token operator">&amp;</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    Use<span class="token punctuation">:</span>   <span class="token string">"sub"</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    Aliases<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"cmd1"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    Short<span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    Long<span class="token punctuation">:</span> <span class="token string">`...`</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    Run<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>rootCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>subCmd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">After creation, we can make global and local flags:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// global</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">rootCmd<span class="token punctuation">.</span><span class="token function">PersistentFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span><span class="token operator">&lt;</span>P<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">viper<span class="token punctuation">.</span><span class="token function">BindPFlag</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">,</span> rootCmd<span class="token punctuation">.</span><span class="token function">PersistentFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">viper<span class="token punctuation">.</span>Get<span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">)</span> <span class="token comment">// to retrieve</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">// local</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">subCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span><span class="token operator">&lt;</span>P<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"lf"</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">cmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Get<span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"lf"</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">There is a function for embedding files into Go code (you can even embed the source code itself):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token boolean">_</span> <span class="token string">"embed"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// go:embed ./some/text/source_code.go</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">var</span> tfile <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token comment">// go:embed ./some/image/path/mountains.png</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token keyword">var</span> imgfile <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">New functions for temporary files/folders:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">os<span class="token punctuation">.</span><span class="token function">MkdirTemp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">CreateTemp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The "os/fs" package represents an abstraction over the file system <code class="code-styler-inline">fs.FS</code> (interface). It can use <code class="code-styler-inline">embed.FS</code>, which implements this interface. Thus, embedded files form their own file system that can be traversed.<br>
<strong>IMPORTANT</strong>: works for <strong>reading only</strong>!</p></div><div class="el-h1"><h1 data-heading="Chapter 7: Parallel Execution" dir="auto" class="heading" id="Chapter_7_Parallel_Execution_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 7: Parallel Execution</h1></div><div class="el-p"><p dir="auto">In Go, the parallelization model is: <em>fork-join</em>. Goroutines are created whenever needed, and synchronization, waiting, and channels — merge the goroutines back into one.</p></div><div class="el-p"><p dir="auto"> A uniform scheduling strategy consists of the compiler pre-allocating processors for everything (evenly). But this is risky because something might suddenly finish and not use its resources, while something else might suddenly become more complex and lack resources.<br>
Therefore, Go uses a strategy of intercepting consequences, distributing resources on the fly according to needs!<br>
Tsoukalos writes: Go can and does use <em>continuation stealing</em> in its <em>work stealing</em> algorithm.</p></div><div class="el-p"><p dir="auto">P — processor, M — OS thread, G — goroutine. This is what the Go scheduler works with.</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>Useful: think about parallelization, not concurrency! (Break the task into independent pieces rather than shoving everything into different cores!)</p>
</blockquote></div><div class="el-p"><p dir="auto">Reminder: the data race detection flag for running or building:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> run <span class="token operator">-</span>race <span class="token operator">...</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><strong>VERY IMPORTANT:</strong> in other languages like Python, we are used to process pools because re-creating them is expensive. In Go, there are also effective pools, but manual re-creation of goroutines is cheap. This should not be confused with a connection pool, which is usually created for databases and is needed in all programming languages.</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>In Go, a process pool is implemented via a buffered channel (as a task pool)!</p>
</blockquote></div><div class="el-p"><p dir="auto">Ways for goroutines to interact:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>channels</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>local sockets</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>shared memory</li>
</ul></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">atomic</code> package:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"sync/atomic"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Used for reading and writing via pointers:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">atomic<span class="token punctuation">.</span><span class="token function">LoadInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">context</code> package:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"context"</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Okay, this is something passed along the call chain, creating new child contexts (if necessary). Contexts are primarily created for canceling goroutines. They are thread-safe. Canceling a context cancels it and all its child contexts. You can pass a value in contexts (which in good practice should be logically related to the context). Here are the main examples:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">Context — <span class="token keyword">interface</span> with methods <span class="token function">Deadline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">basecntx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// you can use context.TODO if you don't understand anything or don't know what to pass further down the call chain</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">cntx2<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span>With<span class="token operator">&lt;</span>Cancel<span class="token operator">/</span>Deadline<span class="token operator">/</span>Timeout<span class="token operator">&gt;</span><span class="token punctuation">(</span>basecntx<span class="token punctuation">,</span> args<span class="token operator">...</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">cntx3 <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithValue</span><span class="token punctuation">(</span>cntx2<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token comment">// k:v are any type</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">cntx3<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment">// returns nil if it is not present for this key</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Important, from an <span style="color:#ff12ffff;">AI</span>: <code class="code-styler-inline">cancel()</code> does not terminate child goroutines, it merely notifies them as context users that they should wrap up! The garbage collector won't touch them until they finish!</p>
</blockquote></div><div class="el-p"><p dir="auto">Semaphore:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"golang.org/x/sync/semaphore"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">sem <span class="token operator">:=</span> semaphore<span class="token punctuation">.</span><span class="token function">NewWeighted</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">sem<span class="token punctuation">.</span><span class="token function">Acquire</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token comment">// you may acquire &gt;1 at once</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">sem<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// and release &gt;1 at once</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 8: Creating Web Services" dir="auto" class="heading" id="Chapter_8_Creating_Web_Services_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 8: Creating Web Services</h1></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">http<span class="token punctuation">.</span>Response <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    Status     <span class="token builtin">string</span> <span class="token comment">// e.g. "200 OK"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    StatusCode <span class="token builtin">int</span>    <span class="token comment">// e.g. 200</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    Proto      <span class="token builtin">string</span> <span class="token comment">// e.g. "HTTP/1.0"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    ProtoMajor <span class="token builtin">int</span>    <span class="token comment">// e.g. 1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    ProtoMinor <span class="token builtin">int</span>    <span class="token comment">// e.g. 0</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    Header Header</div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    Body io<span class="token punctuation">.</span>ReadCloser</div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    ContentLength <span class="token builtin">int64</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    TransferEncoding <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    Close <span class="token builtin">bool</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">    Uncompressed <span class="token builtin">bool</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    Trailer Header</div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    Request <span class="token operator">*</span>Request</div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">    TLS <span class="token operator">*</span>tls<span class="token punctuation">.</span>ConnectionState</div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">http<span class="token punctuation">.</span>Request <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    Method <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    URL <span class="token operator">*</span>url<span class="token punctuation">.</span>URL</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    Proto      <span class="token builtin">string</span> <span class="token comment">// "HTTP/1.0"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    ProtoMajor <span class="token builtin">int</span>    <span class="token comment">// 1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    ProtoMinor <span class="token builtin">int</span>    <span class="token comment">// 0</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    Header Header</div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    Body io<span class="token punctuation">.</span>ReadCloser</div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    GetBody <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>ReadCloser<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    ContentLength <span class="token builtin">int64</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    TransferEncoding <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">    Close <span class="token builtin">bool</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    Host <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    Form url<span class="token punctuation">.</span>Values</div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">    PostForm url<span class="token punctuation">.</span>Values</div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">    MultipartForm <span class="token operator">*</span>multipart<span class="token punctuation">.</span>Form</div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text">    Trailer Header</div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">    RemoteAddr <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">    RequestURI <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">    TLS <span class="token operator">*</span>tls<span class="token punctuation">.</span>ConnectionState</div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">    Cancel <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text">    Response <span class="token operator">*</span>Response</div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text">    Pattern <span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text">    ctx context<span class="token punctuation">.</span>Context</div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text">    pat         <span class="token operator">*</span>pattern</div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text">    matches     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">27</div><div class="code-styler-line-text">    otherValues <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">28</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">(You can also look at: <code class="code-styler-inline">http.Transport</code>, <code class="code-styler-inline">http.Client</code>.)</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>The author writes that if a powerful server is needed, one should use: Nginx or Apache.</p>
</blockquote></div><div class="el-p"><p dir="auto"><strong>IMPORTANT</strong>: we write HTTP code because usually we are running in a Docker container on an Nginx server, which implements HTTPS, providing us with security!</p></div><div class="el-p"><p dir="auto">A handler attached to "/" is the default handler and matches any address not matched by others.</p></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">http.Server</code> can be created explicitly:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">s <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    Addr<span class="token punctuation">:</span>         PORT<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    Handler<span class="token punctuation">:</span>      mux<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    IdleTimeout<span class="token punctuation">:</span>  <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    ReadTimeout<span class="token punctuation">:</span>  time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    WriteTimeout<span class="token punctuation">:</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/insert/"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>insertHandler<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/insert"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>insertHandler<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Note the forms of the route points; a trailing slash indicates any possible continuation.</p>
</blockquote></div><div class="el-p"><p dir="auto">Data types for Prometheus metrics:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>counter (+0, +k, =0) [counter]</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>gauge (±k) [gauge]</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>histogram (usually for counting duration) [histogram]</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>summary (≈histogram, but also +calculates quantiles) [summary]</li>
</ul></div><div class="el-p"><p dir="auto">Retrieving Go metrics:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"runtime/metrics"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">metrics<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// all available metrics</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">genMetric <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>metrics<span class="token punctuation">.</span>Sample<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">genMetric<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">"/sched/goroutines:goroutines"</span>  <span class="token comment">// number of active goroutines</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">metrics<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>genMetric<span class="token punctuation">)</span>  <span class="token comment">// fills the metric values</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token keyword">if</span> genMetric<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> metrics<span class="token punctuation">.</span>KindBad <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token comment">// metric is no longer supported</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token operator">&lt;</span><span class="token builtin">print</span><span class="token operator">&gt;</span> genMetric<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">Uint64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// get the value</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Passing metrics to Prometheus:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// declare and register</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">var</span> <span class="token operator">&lt;</span>counter<span class="token operator">&gt;</span> <span class="token operator">=</span> prometheus<span class="token punctuation">.</span>New<span class="token operator">&lt;</span>Counter<span class="token operator">&gt;</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    prometheus<span class="token punctuation">.</span><span class="token operator">&lt;</span>Counter<span class="token operator">&gt;</span>Opts<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        Namespace<span class="token punctuation">:</span> <span class="token string">"rayskiy7"</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        Name<span class="token punctuation">:</span>      <span class="token string">"my_counter"</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        Help<span class="token punctuation">:</span>      <span class="token string">"This is my counter"</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token operator">...</span> <span class="token comment">// likewise you can use gauge, histogram, summary</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">    prometheus<span class="token punctuation">.</span><span class="token function">MustRegister</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>use<span class="token operator">&gt;</span> counter<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// for histograms and summaries, .Observe() is used</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text"><span class="token comment">// You need to provide a scrape point for Prometheus; it comes to fetch them itself:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/metrics"</span><span class="token punctuation">,</span> promhttp<span class="token punctuation">.</span><span class="token function">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// there is a built-in handler from Prometheus</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>the Prometheus collector, which runs separately, has its own configuration file, which usually describes the polling interval and the address of who will be polled.</li>
</ul></div><div class="el-p"><p dir="auto">To create Docker applications, you need to build an image using a script file:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Dockerfile</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$docker build <span class="token operator">-</span>t res_image_name <span class="token punctuation">.</span>  # build docker image$ docker images  # check build<span class="token punctuation">;</span> list all built images</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">after which a multi-container application is described in a .yml file:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>docker-compose.yml</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$docker<span class="token operator">-</span>compose up$ docker<span class="token operator">-</span>compose down  # to stop or use <span class="token operator">^</span>C</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>! Further details are not described in this note.</p>
</blockquote></div><div class="el-p"><p dir="auto">Way to force garbage collection:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">runtime<span class="token punctuation">.</span><span class="token function">GC</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">For an application collecting its own statistics and sending them to Prometheus, it is sufficient to describe a docker-compose file declaring: the Go application container and the Prometheus container. You can also add Grafana to this setup for beautiful visualization.</p></div><div class="el-p"><p dir="auto">Correct parsing of a URL:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">url<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>inputString<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">You can separately create a client, a request, and run the request from the client:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">c <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Client<span class="token punctuation">{</span>Timeout<span class="token punctuation">:</span> <span class="token number">15</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">request<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>MethodGet<span class="token punctuation">,</span> urlString<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// &lt;body&gt; is nil</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">response<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>can use<span class="token operator">&gt;</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    response<span class="token punctuation">.</span>Status</div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    response<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span> <span class="token comment">// and other keys</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    response<span class="token punctuation">.</span>ContentLength <span class="token comment">// may be -1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    response<span class="token punctuation">.</span>Body <span class="token comment">// io.Reader</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Helper methods for obtaining the HTTP/1.x wire representation of a request/response:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">httputil<span class="token punctuation">.</span><span class="token function">DumpRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">&lt;</span>include body<span class="token operator">&gt;</span><span class="token boolean">false</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">httputil<span class="token punctuation">.</span><span class="token function">DumpResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token operator">&lt;</span>include body<span class="token operator">&gt;</span><span class="token boolean">false</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">File servers.<br>
A full-fledged server:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span> <span class="token comment">// for requests that "miss the mark"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">fileServer <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">FileServer</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">Dir</span><span class="token punctuation">(</span><span class="token string">"/tmp/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// attach server to this local directory</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/files/"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">StripPrefix</span><span class="token punctuation">(</span><span class="token string">"/files"</span><span class="token punctuation">,</span> fileServer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// handler receives a stripped prefix</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Creating a temporary file and a single-file server:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">CreateTemp</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"data*.txt"</span><span class="token punctuation">)</span>  <span class="token comment">// write to this</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">defer</span> os<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">http<span class="token punctuation">.</span><span class="token function">ServeFile</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> tempFileName<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Setting a timeout without context:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">Timeout</span><span class="token punctuation">(</span>network<span class="token punctuation">,</span> host <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>net<span class="token punctuation">.</span>Conn<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">DialTimeout</span><span class="token punctuation">(</span>network<span class="token punctuation">,</span> host<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    conn<span class="token punctuation">.</span><span class="token function">SetDeadline</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token keyword">return</span> conn<span class="token punctuation">,</span> <span class="token boolean">nil</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">t <span class="token operator">:=</span> http<span class="token punctuation">.</span>Transport<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    Dial<span class="token punctuation">:</span> Timeout<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">client <span class="token operator">:=</span> http<span class="token punctuation">.</span>Client<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    Transport<span class="token punctuation">:</span> <span class="token operator">&amp;</span>t<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">data<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>URL<span class="token punctuation">)</span>  <span class="token comment">// Timeout will be called here</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Timeout via context (client side) schematically:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> connect <span class="token punctuation">(</span>c context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    req <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequestWithContext</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> URL<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// picks up the .cancel() of the parent context</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">go</span> client<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token keyword">select</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        <span class="token operator">&lt;</span>check <span class="token keyword">for</span> cancel on our side or success from the goroutine<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Timeout on the server side, essence:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">m <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    srv <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">        Addr<span class="token punctuation">:</span>         PORT<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        Handler<span class="token punctuation">:</span>      m<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        ReadTimeout<span class="token punctuation">:</span>  <span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        WriteTimeout<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 9: Working with TCP/IP and Web-Sockets" dir="auto" class="heading" id="Chapter_9_Working_with_TCP/IP_and_Web-Sockets_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 9: Working with TCP/IP and Web-Sockets</h1></div><div class="el-p"><p dir="auto">Protocol Hierarchy:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">IP <span class="token operator">-</span><span class="token operator">&gt;</span> TCP <span class="token operator">-</span><span class="token operator">&gt;</span> HTTP <span class="token operator">-</span><span class="token operator">&gt;</span> WebSocket <span class="token punctuation">(</span>well<span class="token punctuation">,</span> roughly speaking<span class="token punctuation">,</span> haha<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">TCP — reliable data transmission via TCP packets, which typically include a port in their headers.<br>
Ports 0-1024 are restricted to root access, which is risky. It's better to avoid them.</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>Port 0 assigns any available unprivileged port.</p>
</blockquote></div><div class="el-p"><p dir="auto">Primary console utility for TCP:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">netcat <span class="token operator">&lt;</span>ipv4<span class="token operator">/</span>ipv6<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>port<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">flags<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token operator">-</span>l<span class="token punctuation">,</span> run as a server</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token operator">-</span>u<span class="token punctuation">,</span> UDP protocol</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token operator">-</span>v and <span class="token operator">-</span>vv<span class="token punctuation">,</span> verbose output</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The <code class="code-styler-inline">net</code> package:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>     <span class="token comment">// client</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>   <span class="token comment">// server</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// return:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">net<span class="token punctuation">.</span>Conn <span class="token punctuation">(</span>implements io<span class="token punctuation">.</span>Reader <span class="token operator">&amp;</span> io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Valid network parameters for <code class="code-styler-inline">net.Dial()</code>, "L" marks those used with <code class="code-styler-inline">Listen</code>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">tcp</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token function">tcp4</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token function">tcp6</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">udp  udp4 udp6</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">ip   ip4 ip6</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token function">unix</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> unixgram <span class="token function">unixpacket</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Simple TCP server creation:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Note: A connection closes when the client sends an EOF, signaling the end of the read stream (i.e., the client has nothing more to send).<br>
There is a lower-level method:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">ResolveTCPAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token function">DialTCP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">ListenTCP</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">A bit about UDP:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// client:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">ResolveUDPAddr</span><span class="token punctuation">(</span><span class="token string">"udp4"</span><span class="token punctuation">,</span> CONNECT<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">DialUDP</span><span class="token punctuation">(</span><span class="token string">"udp4"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token comment">// server:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">ResolveUDPAddr</span><span class="token punctuation">(</span><span class="token string">"udp4"</span><span class="token punctuation">,</span> PORT<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">net<span class="token punctuation">.</span><span class="token function">ListenUDP</span><span class="token punctuation">(</span><span class="token string">"udp4"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">Clients and servers <span class="token keyword">for</span> UDP use<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token punctuation">.</span><span class="token function">ReadFromUDP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span><span class="token function">WriteToUDP</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>These methods are used because a UDP server accepts packets from MULTIPLE (any) clients simultaneously.</li>
</ul></div><div class="el-p"><p dir="auto">Creating a UNIX socket is very similar to creating a standard TCP socket, but you pass a file path instead of host:port:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">l<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">"unix"</span><span class="token punctuation">,</span> <span class="token string">"path/to/unix/socket"</span><span class="token punctuation">)</span>  <span class="token comment">// the socket file must be deleted before starting the server!</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">WebSockets.</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Use third-party libraries:</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">github<span class="token punctuation">.</span>com<span class="token operator">/</span>gorilla<span class="token operator">/</span>websocket</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">nhooyr<span class="token punctuation">.</span>io<span class="token operator">/</span>websocket</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>NEVER use <code class="code-styler-inline">fmt.Fprint</code> functions for writing to or reading from a WebSocket because they require proper fragmentation (working with frames).</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Usage:</li>
</ul></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">ws<span class="token punctuation">,</span> err <span class="token operator">:=</span> upgrader<span class="token punctuation">.</span><span class="token function">Upgrade</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// upgrade HTTP to WS</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">mt<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ws<span class="token punctuation">.</span><span class="token function">ReadMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">ws<span class="token punctuation">.</span><span class="token function">WriteMessage</span><span class="token punctuation">(</span>mt<span class="token punctuation">,</span> message<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token comment">// important: check errors!</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Console utility for working with WebSockets:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">websocat</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Creating your own WebSocket client:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">ws<span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token operator">:=</span> websocket<span class="token punctuation">.</span>DefaultDialer<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span>wsServer<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">defer</span> ws<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>do work<span class="token operator">...</span><span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">ws<span class="token punctuation">.</span><span class="token function">WriteMessage</span><span class="token punctuation">(</span>websocket<span class="token punctuation">.</span>CloseMessage<span class="token punctuation">,</span> websocket<span class="token punctuation">.</span><span class="token function">FormatCloseMessage</span><span class="token punctuation">(</span>websocket<span class="token punctuation">.</span>CloseNormalClosure<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token keyword">return</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Interesting technique: Re-creating the goroutine that reads user input to make it non-blocking.<br>
Trick:</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">url<span class="token punctuation">.</span>URL<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    Scheme<span class="token punctuation">:</span> <span class="token string">"ws"</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    Host<span class="token punctuation">:</span>   host<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    Path<span class="token punctuation">:</span>   path<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Reminder:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">interrupt <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> os<span class="token punctuation">.</span>Signal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">signal<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>interrupt<span class="token punctuation">,</span> os<span class="token punctuation">.</span>Interrupt<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Trick:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">syscall<span class="token punctuation">.</span><span class="token function">Kill</span><span class="token punctuation">(</span>syscall<span class="token punctuation">.</span><span class="token function">Getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>SIGINT<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 10: Working with REST API" dir="auto" class="heading" id="Chapter_10_Working_with_REST_API_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 10: Working with REST API</h1></div><div class="el-p"><p dir="auto">Error response function:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Error text"</span><span class="token punctuation">,</span> errCode<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">How to specify that the client wants to send JSON to the server:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">request<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Use the router package:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">gorilla<span class="token operator">/</span>mux</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">to create a more advanced RESTful server. It is essentially a framework.<br>
This package provides advanced features:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Restricting HTTP methods for specific endpoints.</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Default handlers: <code class="code-styler-inline">mux.NotFoundHandler</code> and <code class="code-styler-inline">mux.MethodNotAllowedHandler</code>.</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>URL pattern matching like <code class="code-styler-inline">GET /users/{id:[0-9]+}</code>.</li>
</ul></div><div class="el-p"><p dir="auto">The creation of handlers isn't particularly unique, but generally, a <code class="code-styler-inline">gorilla/mux</code> server is set up like this:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">var</span> rMux <span class="token operator">=</span> mux<span class="token punctuation">.</span><span class="token function">NewRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    s <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        <span class="token comment">// address config, rMux multiplexer, timeouts, etc.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    rMux<span class="token punctuation">.</span>NotFoundHandler <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>DefaultHandler<span class="token punctuation">)</span>  <span class="token comment">// default 404 handler via wrapper</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    rMux<span class="token punctuation">.</span>MethodNotAllowedHandler <span class="token operator">=</span> notAllowedHandler<span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token comment">// default 405 handler via interface</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    rMux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/endp_1"</span><span class="token punctuation">,</span> Handler_1<span class="token punctuation">)</span>  <span class="token comment">// handles all HTTP methods</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    getMux <span class="token operator">:=</span> rMux<span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>MethodGet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Subrouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    getMux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/endp_2"</span><span class="token punctuation">,</span> Handler_2<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">    getMux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/endp_3/{id:[0-9]+}"</span><span class="token punctuation">,</span> Handler_3<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">    <span class="token comment">// and other handlers...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">    putMux <span class="token operator">:=</span> rMux<span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>MethodPut<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Subrouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">    putMux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/endp_4"</span><span class="token punctuation">,</span> Handler_4<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">    <span class="token comment">// ...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text">    <span class="token comment">// AND OTHER HTTP METHODS...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text">    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// run server</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text">        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Listening on"</span><span class="token punctuation">,</span> PORT<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text">        err <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">27</div><div class="code-styler-line-text">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">28</div><div class="code-styler-line-text">            log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Error starting server: %s\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">29</div><div class="code-styler-line-text">            <span class="token keyword">return</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">30</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">31</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">32</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">33</div><div class="code-styler-line-text">    <span class="token comment">// catch SIGINT and then shutdown:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">34</div><div class="code-styler-line-text">    s<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Note: Two structures with identical fields are still considered different types by Go!</p></div><div class="el-p"><p dir="auto">A REST API can have several versions, implemented via:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">HTTP Headers</li>
<li data-line="1" dir="auto">Subdomains (3rd level)</li>
<li data-line="2" dir="auto"><code class="code-styler-inline">Accept</code> and <code class="code-styler-inline">Content-Type</code> headers</li>
<li data-line="3" dir="auto">Different sub-routes</li>
<li data-line="4" dir="auto">URL Parameters</li>
</ol></div><div class="el-p"><p dir="auto">Using <code class="code-styler-inline">gorilla/mux</code>, you can create a file server for binary files:</p></div><div class="el-blockquote"><blockquote dir="auto">
<p>For <code class="code-styler-inline">PUT</code>, set a custom handler for saving (e.g., locally).<br>
For <code class="code-styler-inline">GET</code>, use the standard <code class="code-styler-inline">http.FileServer</code>.</p>
</blockquote></div><div class="el-p"><p dir="auto">How to extract a parameter from a URL:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">mux<span class="token punctuation">.</span><span class="token function">Vars</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"some_param_name"</span><span class="token punctuation">]</span> <span class="token comment">// returns the value</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Working with Swagger:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> install github<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">-</span>swagger<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">-</span>swagger<span class="token operator">/</span>cmd<span class="token operator">/</span>swagger@latest</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Adding markup-comments. Preamble:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// Documentation for REST API</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">//  Schemes: http</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token comment">//  BasePath: /</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">//  Version: 1.0.7</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token comment">//  Consumes:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token comment">//  - application/json</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token comment">//  Produces:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token comment">//  - application/json</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text"><span class="token comment">// swagger:meta</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Specific declarations (leaked into docs):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// @termsOfService http://swagger.io/terms/</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Data:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// User defines the structure for a Full User Record</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// swagger:model</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token comment">// The ID for the user</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token comment">// in: body</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    <span class="token comment">// required: false</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    <span class="token comment">// min: 1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    ID <span class="token builtin">int</span> <span class="token string">`json:"id"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">    <span class="token comment">// The Username of the user</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    <span class="token comment">// in: body</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    <span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">    <span class="token comment">// required: true</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">    Username <span class="token builtin">string</span> <span class="token string">`json:"username"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">    <span class="token comment">// The Password of the user</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">    <span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">    <span class="token comment">// required: true</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">    Password <span class="token builtin">string</span> <span class="token string">`json:"password"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text">    <span class="token comment">// The Last Login time of the User</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text">    <span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text">    <span class="token comment">// required: true</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text">    <span class="token comment">// min: 0</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">27</div><div class="code-styler-line-text">    LastLogin <span class="token builtin">int64</span> <span class="token string">`json:"lastlogin"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">28</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">29</div><div class="code-styler-line-text">    <span class="token comment">// Is the User Admin or not</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">30</div><div class="code-styler-line-text">    <span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">31</div><div class="code-styler-line-text">    <span class="token comment">// required: true</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">32</div><div class="code-styler-line-text">    Admin <span class="token builtin">int</span> <span class="token string">`json:"admin"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">33</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">34</div><div class="code-styler-line-text">    <span class="token comment">// Is the User Logged In or Not</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">35</div><div class="code-styler-line-text">    <span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">36</div><div class="code-styler-line-text">    <span class="token comment">// required: true</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">37</div><div class="code-styler-line-text">    Active <span class="token builtin">int</span> <span class="token string">`json:"active"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">38</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Route documentation:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// swagger:route DELETE /delete/{id} DeleteUser deleteID</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token comment">// Delete a user given their ID.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// The command should be issued by an admin user</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">// responses:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token comment">// 200: noContent</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token comment">// 404: ErrorMessage</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">and:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// swagger:route GET /logged logged getUserInfo</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token comment">// Returns a list of logged-in users</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">//</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token comment">// responses:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">// 200: UsersResponse</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token comment">// 400: BadRequest</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Documentation usually refers to different parameter entities (e.g., <code class="code-styler-inline">deleteID</code>) and response entities (e.g., <code class="code-styler-inline">UsersResponse</code>). These entities must also be documented as Go code, typically placed in a separate file named <code class="code-styler-inline">docs.go</code>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// swagger:parameters deleteID</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">type</span> idParamWrapper <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token comment">// The user id to be deleted</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token comment">// in: path</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token comment">// required: true</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    ID <span class="token builtin">int</span> <span class="token string">`json:"id"`</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token comment">// A list of Users</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token comment">// swagger:response UsersResponse</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token keyword">type</span> UsersResponseWrapper <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">    <span class="token comment">// A list of users</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    <span class="token comment">// in: body</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    Body <span class="token punctuation">[</span><span class="token punctuation">]</span>User</div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Note: In <code class="code-styler-inline">swagger:parameters</code>, you can specify more than one parameter at once.</p>
</blockquote></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">gorilla/mux</code> allows adding middleware for its routers:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">mymux<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span> <span class="token comment">// middleware = func(http.Handler) http.Handler</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Generating <code class="code-styler-inline">.yaml</code> documentation from Swagger comments in Go code:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ swagger generate spec <span class="token operator">--</span>scan<span class="token operator">-</span>models <span class="token operator">-</span>o <span class="token punctuation">.</span><span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>out<span class="token punctuation">.</span>yaml</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">And the code to launch a server displaying the generated documentation:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">getMux <span class="token operator">:=</span> mux<span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>MethodGet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Subrouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">opts <span class="token operator">:=</span> middleware<span class="token punctuation">.</span>RedocOpts<span class="token punctuation">{</span>SpecURL<span class="token punctuation">:</span> <span class="token string">"/swagger.yaml"</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">sh <span class="token operator">:=</span> middleware<span class="token punctuation">.</span><span class="token function">Redoc</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">getMux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/docs"</span><span class="token punctuation">,</span> sh<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">There is also a separate site for viewing OpenAPI files (yamls):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>editor<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>io<span class="token operator">/</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Library for encoding Go structures into URL parameters:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span><span class="token operator">-</span>querystring</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Package for validating incoming JSON data:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">validator</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 11: Testing and Profiling" dir="auto" class="heading" id="Chapter_11_Testing_and_Profiling_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 11: Testing and Profiling</h1></div><div class="el-p"><p dir="auto">Flag for <code class="code-styler-inline">go test</code> to run tests and benchmarks in random order:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>shuffle<span class="token operator">=</span>on <span class="token operator">...</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">A pattern trick of renaming <code class="code-styler-inline">main</code> to <code class="code-styler-inline">run</code> to allow calling <code class="code-styler-inline">run()</code> from other executable programs:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    err <span class="token operator">:=</span> <span class="token function">run</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">,</span> os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">        <span class="token keyword">return</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token keyword">func</span> run <span class="token punctuation">(</span>args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> stdout io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    <span class="token comment">// write main business logic here ;)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    <span class="token keyword">return</span> <span class="token boolean">nil</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">IMPORTANT:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code class="code-styler-inline">b.N</code> — how many times to call the target function in the current benchmark iteration.</li>
<li data-line="1" dir="auto">Each benchmark runs for at least one second, gradually increasing <code class="code-styler-inline">b.N</code>.</li>
<li data-line="2" dir="auto">It's better to save target function results to a global variable so the compiler doesn't optimize away a function call with an unused result (as claimed by Tsoukalos).</li>
</ol></div><div class="el-p"><p dir="auto">Folder treated specially by Go for test-required data:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">testdata</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">How to run multiple sub-benchmarks from a single benchmark:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">b<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> subbench <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">In this case, the enclosing benchmark itself is not measured!</p></div><div class="el-p"><p dir="auto">Execution command:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>bench<span class="token operator">=</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token operator">-</span>benchmem<span class="token punctuation">]</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token keyword">go</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Note, output includes:</p>
<ol>
<li data-line="1" dir="auto">The <code class="code-styler-inline">-8</code> suffix displaying the number of CPU cores.</li>
<li data-line="2" dir="auto">The first column shows the benchmark score — number of operations completed.</li>
<li data-line="3" dir="auto">Average time in ns/op.</li>
</ol>
</blockquote></div><div class="el-p"><p dir="auto">Compare a couple of benchmark outputs using:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">benchstat <span class="token punctuation">(</span><span class="token keyword">go</span> install golang<span class="token punctuation">.</span>org<span class="token operator">/</span>x<span class="token operator">/</span>perf<span class="token operator">/</span>cmd<span class="token operator">/</span>benchstat@latest<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><u>Profiling.</u></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">runtime<span class="token operator">/</span>pprof — profiling applications <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span><span class="token punctuation">,</span> CLI<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">net<span class="token operator">/</span>http<span class="token operator">/</span>pprof — profiling a web server</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Profiling from CLI application code:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">pprof<span class="token punctuation">.</span><span class="token function">StartCPUProfile</span><span class="token punctuation">(</span>cpuOut<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">defer</span> pprof<span class="token punctuation">.</span><span class="token function">StopCPUProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">pprof<span class="token punctuation">.</span><span class="token function">WriteHeapProfile</span><span class="token punctuation">(</span>memoryOut<span class="token punctuation">)</span> <span class="token comment">// in a loop</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Command with multiple launch variants to view profiles:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> tool pprof <span class="token operator">...</span>  <span class="token comment">// ask the AI for more details</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Profiling an HTTP server:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/debug/pprof/"</span><span class="token punctuation">,</span> pprof<span class="token punctuation">.</span>Index<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/debug/pprof/cmdline"</span><span class="token punctuation">,</span> pprof<span class="token punctuation">.</span>Cmdline<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/debug/pprof/profile"</span><span class="token punctuation">,</span> pprof<span class="token punctuation">.</span>Profile<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/debug/pprof/symbol"</span><span class="token punctuation">,</span> pprof<span class="token punctuation">.</span>Symbol<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/debug/pprof/trace"</span><span class="token punctuation">,</span> pprof<span class="token punctuation">.</span>Trace<span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Viewing the profile is similar to standard console tools:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> tool pprof http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>yourdomain<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>debug<span class="token operator">/</span>pprof<span class="token operator">/</span>profile</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Afterward, you enter interactive mode (<code class="code-styler-inline">%</code>) and can use commands like <code class="code-styler-inline">top</code>, <code class="code-styler-inline">cum</code>, <code class="code-styler-inline">list</code>, etc.</p></div><div class="el-p"><p dir="auto">You can view the profile in a web interface:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> tool pprof <span class="token operator">-</span>http<span class="token operator">=</span>localhost<span class="token punctuation">:</span><span class="token number">8080</span> aProfile<span class="token punctuation">.</span>out</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><u>Tracing.</u></p></div><div class="el-p"><p dir="auto">Viewing a trace (launches web mode immediately):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> tool trace <span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>trace<span class="token operator">/</span>file<span class="token punctuation">.</span>out</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Generating a trace (3 variants):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">runtime<span class="token operator">/</span>trace</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">net<span class="token operator">/</span>http<span class="token operator">/</span>httptrace</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>trace</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">1st variant - collecting a trace for a regular application:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">err <span class="token operator">:=</span> trace<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>outfile<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">&lt;</span>process err<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">defer</span> trace<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">2nd variant - collecting a web server trace from the client side:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">client <span class="token operator">:=</span> http<span class="token punctuation">.</span>Client<span class="token punctuation">{</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">req<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> URL<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">trace <span class="token operator">:=</span> <span class="token operator">&amp;</span>httptrace<span class="token punctuation">.</span>ClientTrace<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    GotFirstResponseByte<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"First response byte!"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    GotConn<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>connInfo httptrace<span class="token punctuation">.</span>GotConnInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Got Conn: %+v\n"</span><span class="token punctuation">,</span> connInfo<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    DNSDone<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>dnsInfo httptrace<span class="token punctuation">.</span>DNSDoneInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"DNS Info: %+v\n"</span><span class="token punctuation">,</span> dnsInfo<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    ConnectStart<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>network<span class="token punctuation">,</span> addr <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Dial start"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text">    ConnectDone<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>network<span class="token punctuation">,</span> addr <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Dial done"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">    WroteHeaders<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Wrote headers"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text">    <span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text">req <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">WithContext</span><span class="token punctuation">(</span>httptrace<span class="token punctuation">.</span><span class="token function">WithClientTrace</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> trace<span class="token punctuation">)</span><span class="token punctuation">)</span> </div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Requesting data from server!"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">27</div><div class="code-styler-line-text"><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span>DefaultTransport<span class="token punctuation">.</span><span class="token function">RoundTrip</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">28</div><div class="code-styler-line-text"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">29</div><div class="code-styler-line-text">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">30</div><div class="code-styler-line-text">    <span class="token keyword">return</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">31</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">32</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">33</div><div class="code-styler-line-text"><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span> </div></div><div class="code-styler-line"><div class="code-styler-line-number">34</div><div class="code-styler-line-text"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">35</div><div class="code-styler-line-text">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">36</div><div class="code-styler-line-text">    <span class="token keyword">return</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">37</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">You can also view all available routes on the server side:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Walk</span><span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">func</span><span class="token punctuation">(</span>route <span class="token operator">*</span>mux<span class="token punctuation">.</span>Route<span class="token punctuation">,</span> router <span class="token operator">*</span>mux<span class="token punctuation">.</span>Router<span class="token punctuation">,</span> ancestors <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>mux<span class="token punctuation">.</span>Route<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">        pathTemplate<span class="token punctuation">,</span> err <span class="token operator">:=</span> route<span class="token punctuation">.</span><span class="token function">GetPathTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ROUTE:"</span><span class="token punctuation">,</span> pathTemplate<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">        pathRegexp<span class="token punctuation">,</span> err <span class="token operator">:=</span> route<span class="token punctuation">.</span><span class="token function">GetPathRegexp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Path regexp:"</span><span class="token punctuation">,</span> pathRegexp<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">        qT<span class="token punctuation">,</span> err <span class="token operator">:=</span> route<span class="token punctuation">.</span><span class="token function">GetQueriesTemplates</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Queries templates:"</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>qT<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">        qRegexps<span class="token punctuation">,</span> err <span class="token operator">:=</span> route<span class="token punctuation">.</span><span class="token function">GetQueriesRegexp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text">            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Queries regexps:"</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>qRegexps<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">        methods<span class="token punctuation">,</span> err <span class="token operator">:=</span> route<span class="token punctuation">.</span><span class="token function">GetMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text">            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Methods:"</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>methods<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text">        <span class="token keyword">return</span> <span class="token boolean">nil</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><u>Testing.</u></p></div><div class="el-p"><p dir="auto">For tests and benchmarks, you can call:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">defer</span> t<span class="token punctuation">.</span><span class="token function">Cleanup</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// final teardown actions</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">A very convenient package for automated random testing:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token string">"testing"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token string">"testing/quick"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">TestSomething</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    cond <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>some params<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token operator">...</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    err <span class="token operator">:=</span> quick<span class="token punctuation">.</span><span class="token function">Check</span><span class="token punctuation">(</span>cond<span class="token punctuation">,</span> <span class="token operator">&amp;</span>quick<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>MaxCount<span class="token punctuation">:</span> N<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// auto random test</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Testing tool flags:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ <span class="token keyword">go</span> test <span class="token operator">&lt;</span><span class="token operator">...</span><span class="token operator">&gt;</span> <span class="token operator">-</span>timeout<span class="token operator">=</span>2s <span class="token operator">-</span>count<span class="token operator">=</span><span class="token number">1</span>  # sets max time <span class="token keyword">for</span> all tests and number of repetitions</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Investigating coverage:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$<span class="token keyword">go</span> test <span class="token operator">-</span>cover <span class="token operator">*</span><span class="token punctuation">.</span><span class="token keyword">go</span>   # shows coverage percentage$ <span class="token keyword">go</span> test <span class="token operator">-</span>coverprofile<span class="token operator">=</span>coverage<span class="token punctuation">.</span>out <span class="token operator">*</span><span class="token punctuation">.</span><span class="token keyword">go</span>   # creates a coverage profile file</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">How to beautifully open the coverage profile file:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ <span class="token keyword">go</span> tool cover <span class="token operator">-</span>html<span class="token operator">=</span>coverage<span class="token punctuation">.</span>out</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Go's built-in lightweight staticcheck tool:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> vet somefile<span class="token punctuation">.</span><span class="token keyword">go</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">How to test an HTTP server:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"net/http/httptest"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">rr <span class="token operator">:=</span> httptest<span class="token punctuation">.</span><span class="token function">NewRecorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">handler <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>MyHandleFunc<span class="token punctuation">)</span>  <span class="token comment">// returns http.Handler</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">handler<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>rr<span class="token punctuation">,</span> req<span class="token punctuation">)</span>  <span class="token comment">// essentially passes the recorder instead of a response writer</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Note: if you need to set dynamic path variables for <code class="code-styler-inline">gorilla/mux</code> in a test:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">req <span class="token operator">=</span> mux<span class="token punctuation">.</span><span class="token function">SetURLVars</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> vars<span class="token punctuation">)</span>  <span class="token comment">// where vars is map[string]string</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">There is a newer type of testing called Fuzzing:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">FuzzSomeFunc</span><span class="token punctuation">(</span>f <span class="token operator">*</span>testing<span class="token punctuation">.</span>F<span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    f<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"some input"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    f<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"some other input"</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    f<span class="token punctuation">.</span><span class="token function">Fuzz</span><span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">        <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">,</span> input <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// called with seed data and random inputs</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">            <span class="token operator">&lt;</span>check your SomeFunc here<span class="token operator">&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    <span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Execution:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">go</span> test <span class="token operator">-</span>fuzz <span class="token punctuation">[</span><span class="token operator">-</span>fuzztime<span class="token operator">=</span>10s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>fuzzprog<span class="token operator">=</span>some<span class="token punctuation">.</span>concrete<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>fuzzdir<span class="token operator">=</span><span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>out<span class="token punctuation">]</span> target</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Cross-compilation in Go is achieved via environment variables:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">GOOS<span class="token operator">=</span>linux GOARCH<span class="token operator">=</span>amd64 <span class="token keyword">go</span> build someprogram<span class="token punctuation">.</span><span class="token keyword">go</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Directive:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// go:generate echo hello</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Triggers a shell command when the corresponding tool is executed:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ <span class="token keyword">go</span> generate</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Available flags:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code class="code-styler-inline">-v</code>: output names of packages and files</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code class="code-styler-inline">-n</code>: print commands without executing them</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code class="code-styler-inline">-x</code>: print commands before execution</li>
</ul></div><div class="el-p"><p dir="auto">Reminder:<br>
Example functions exist (interestingly, they don't need the <code class="code-styler-inline">testing</code> package):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">ExampleSquare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Square</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token comment">// Output:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">// 49</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 12: gRPC and Protobuf" dir="auto" class="heading" id="Chapter_12_gRPC_and_Protobuf_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 12: gRPC and Protobuf</h1></div><div class="el-p"><p dir="auto">Key steps in creating a gRPC server+client (Remote Procedure Calls):</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">IDL — Interface Definition Language</li>
<li data-line="1" dir="auto">Creating the gRPC server</li>
<li data-line="2" dir="auto">Creating the gRPC client</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>gRPC is built on top of HTTP/2</p>
</blockquote></div><div class="el-p"><p dir="auto">The <code class="code-styler-inline">.proto</code> file defines the protoapi.<br>
Choosing the version and working with namespaces:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">syntax <span class="token operator">=</span> <span class="token string">"proto3"</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">package</span> mypack<span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token string">"other.pack"</span><span class="token punctuation">;</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Location and name of the generated code:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">option go_package <span class="token operator">=</span> <span class="token string">"./;packname"</span><span class="token punctuation">;</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Defining the service and its interface:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">service ServiceName <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    rpc <span class="token function">SomeFunc</span><span class="token punctuation">(</span>MessType<span class="token punctuation">)</span> returns <span class="token punctuation">(</span>OtherType<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// comments allowed</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Defining types:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">message MessType<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token builtin">string</span> SomeField <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">enum Color <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    Red <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    Green <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">    Blue <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">message B<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    A x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    <span class="token builtin">int64</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">    repeated <span class="token builtin">string</span> z <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    Color c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    reserved <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">    reserved <span class="token string">"oldname"</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><span style="color:#ff12ffff;">The .proto files must be compiled using the compiler:</span></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ brew install protobuf  # installs protoc</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><span style="color:#ff12ffff;">To generate Go code, you will need:</span></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"># <span class="token keyword">for</span> generating data structures <span class="token punctuation">(</span>protobuf<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">$ <span class="token keyword">go</span> install google<span class="token punctuation">.</span>golang<span class="token punctuation">.</span>org<span class="token operator">/</span>protobuf<span class="token operator">/</span>cmd<span class="token operator">/</span>protoc<span class="token operator">-</span>gen<span class="token operator">-</span><span class="token keyword">go</span>@latest</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"># <span class="token keyword">for</span> generating the service <span class="token punctuation">(</span>gRPC<span class="token punctuation">)</span><span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">$ <span class="token keyword">go</span> install google<span class="token punctuation">.</span>golang<span class="token punctuation">.</span>org<span class="token operator">/</span>grpc<span class="token operator">/</span>cmd<span class="token operator">/</span>protoc<span class="token operator">-</span>gen<span class="token operator">-</span><span class="token keyword">go</span><span class="token operator">-</span>grpc@latest</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">If the plugins are installed, you can generate Go code:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ protoc <span class="token operator">--</span>go_out<span class="token operator">=</span><span class="token punctuation">.</span> <span class="token operator">--</span><span class="token keyword">go</span><span class="token operator">-</span>grpc_out<span class="token operator">=</span><span class="token punctuation">.</span> myfile<span class="token punctuation">.</span>proto</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">(Tsoukalos also demonstrates using options):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token operator">--</span>go_opt<span class="token operator">=</span>paths<span class="token operator">=</span>source_relative</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token operator">--</span><span class="token keyword">go</span><span class="token operator">-</span>grpc_opt<span class="token operator">=</span>paths<span class="token operator">=</span>source_relative</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p><code class="code-styler-inline">protoc</code> generates <code class="code-styler-inline">apiname.pb.go</code> and <code class="code-styler-inline">apiname_grpc.pb.go</code> files containing the protobuf and gRPC service code respectively. Both files declare: <code class="code-styler-inline">package packaname</code>! Therefore, when creating a server/client, you must import this specific package.</p>
</blockquote></div><div class="el-p"><p dir="auto">Creating a gRPC server. Key points:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token string">"path/to/my/myapi"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token string">"google.golang.org/grpc"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token string">"google.golang.org/grpc/reflection"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><span class="token keyword">type</span> ServiceServer <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">    myapi<span class="token punctuation">.</span>UnimplementedServiceServer</div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token punctuation">(</span>ServiceServer<span class="token punctuation">)</span> SomeFunc <span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> arg <span class="token operator">*</span>myapi<span class="token punctuation">.</span>MessType<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>myapi<span class="token punctuation">.</span>OtherType<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text">    <span class="token comment">// get fields: arg.GetSomeField()</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text">    <span class="token comment">// create and set fields: return &amp;myapi.OtherType{Value: int64(47)}, nil</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">    server <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">    <span class="token keyword">var</span> grpcServer ServiceServer</div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">    myapi<span class="token punctuation">.</span><span class="token function">RegisterServiceServer</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token operator">&amp;</span>grpcServer<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">22</div><div class="code-styler-line-text">    reflection<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span>  <span class="token comment">// needed when there's more than one service in .proto</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">23</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">24</div><div class="code-styler-line-text">    listen<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">":8080"</span><span class="token punctuation">)</span>  <span class="token comment">// noqa: ignore err</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">25</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">26</div><div class="code-styler-line-text">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Serving requests..."</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">27</div><div class="code-styler-line-text">    server<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span>listen<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">28</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Creating a gRPC client. Key points:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">import</span> <span class="token punctuation">(</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token operator">...</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token string">"path/to/my/myapi"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">    <span class="token string">"google.golang.org/grpc"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">CallSomeFunc</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> c myapi<span class="token punctuation">.</span>ServiceClient<span class="token punctuation">,</span> in <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>myapi<span class="token punctuation">.</span>OtherType<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">    arg <span class="token operator">:=</span> <span class="token operator">&amp;</span>myapi<span class="token punctuation">.</span>MessType<span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">        SomeField<span class="token punctuation">:</span> in<span class="token punctuation">,</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">    <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">SomeFunc</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> arg<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">15</div><div class="code-styler-line-text">    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithInsecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// noqa: ignore err</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">16</div><div class="code-styler-line-text">    client <span class="token operator">:=</span> myapi<span class="token punctuation">.</span><span class="token function">NewServiceClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">17</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">18</div><div class="code-styler-line-text">    in <span class="token operator">:=</span> <span class="token string">"some input"</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">19</div><div class="code-styler-line-text">    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CallSomeFunc</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> client<span class="token punctuation">,</span> in<span class="token punctuation">)</span>  <span class="token comment">// noqa: ignore err</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">20</div><div class="code-styler-line-text">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Result (int64):"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Value<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">21</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Advanced gRPC features:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Passing arrays</li>
<li data-line="1" dir="auto">Streaming (Client-side, Server-side, Bi-directional)</li>
</ol></div><div class="el-p"><p dir="auto">Testing gRPC:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ grpcurl <span class="token operator">...</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-h1"><h1 data-heading="Chapter 13: Generics" dir="auto" class="heading" id="Chapter_13_Generics_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Chapter 13: Generics</h1></div><div class="el-p"><p dir="auto">Functions:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> Add<span class="token punctuation">[</span>T Numeric<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b T<span class="token punctuation">)</span> T <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    <span class="token keyword">return</span> a<span class="token operator">+</span>b</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token keyword">type</span> Numeric <span class="token keyword">interface</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">    ~<span class="token builtin">int</span> <span class="token operator">|</span> ~<span class="token builtin">int32</span> <span class="token operator">|</span> ~<span class="token builtin">int64</span>  <span class="token comment">// the 'type' keyword can be omitted; '~' includes underlying types</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text"><span class="token comment">// usage:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text"><span class="token comment">// Add(2, 3)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token comment">// or</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text"><span class="token comment">// Add[int](2, 3)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Types and methods:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> List<span class="token punctuation">[</span>T any<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>T</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token comment">// Note the lack of constraint in the receiver</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token punctuation">(</span>l List<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> T <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">    <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Structures:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> Box<span class="token punctuation">[</span>T any<span class="token punctuation">]</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    Value T</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><strong>APPENDIX: GC (Garbage Collector)</strong></p></div><div class="el-blockquote"><blockquote dir="auto">
<p>В Go, <code class="code-styler-inline">new()</code> doesn't necessarily send a created variable to the heap, nor does <code class="code-styler-inline">x:=</code> send it to the stack (this is why you can return the address of a local variable from a function). To see the compiler's escape analysis decisions, run:</p>
</blockquote></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ <span class="token keyword">go</span> run <span class="token operator">-</span>gcflags <span class="token char">'-m'</span> program<span class="token punctuation">.</span><span class="token keyword">go</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">or<span class="token punctuation">:</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">$ <span class="token keyword">go</span> run <span class="token operator">-</span>gcflags <span class="token char">'-m -m'</span> program<span class="token punctuation">.</span><span class="token keyword">go</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">runtime.MemStats</code> parameters for inspection:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">mem<span class="token punctuation">.</span>Alloc</div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">mem<span class="token punctuation">.</span>TotalAlloc</div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">mem<span class="token punctuation">.</span>HeapAlloc</div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">mem<span class="token punctuation">.</span>NumGC</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Flags to see GC cycle traces during execution:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">$ GODEBUG<span class="token operator">=</span>gctrace<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">go</span> run myprog<span class="token punctuation">.</span><span class="token keyword">go</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>Go uses a tricolor marking algorithm for garbage collection (black/grey/white).</p>
</blockquote></div><div class="el-blockquote"><blockquote dir="auto">
<p>(Tsoukalos)? Maps have a worse impact on application speed than slices because they cause the garbage collector to work more slowly.</p>
</blockquote></div><div class="el-h1"><h1 data-heading="Additional" dir="auto" class="heading" id="Additional_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Additional</h1></div><div class="el-p"><p dir="auto">Containerization — creating applications in a wrapped container that is "guaranteed to work" regardless of the launch platform and the local environment!</p></div><div class="el-p"><p dir="auto">Iterators in Go are implemented as a <code class="code-styler-inline">range</code> over a function having the signature:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span><span class="token punctuation">(</span>yield <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token builtin">bool</span><span class="token punctuation">)</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Essentially, Go passes the loop body as the <code class="code-styler-inline">yield</code> function, replacing <code class="code-styler-inline">continue</code> with <code class="code-styler-inline">return true</code> and <code class="code-styler-inline">break</code> with <code class="code-styler-inline">return false</code>.<br>
Example:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">func</span> <span class="token function">Fib</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> iter<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    a<span class="token punctuation">,</span> b <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>yield <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">        <span class="token keyword">for</span> <span class="token punctuation">;</span> n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> n<span class="token operator">--</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">            <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">yield</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">                <span class="token keyword">return</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">            <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">            a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a<span class="token operator">+</span>b</div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">        <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">    <span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Now it can be used in a <code class="code-styler-inline">range</code>:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">Fib</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">The <code class="code-styler-inline">yield</code> function allows only 0, 1, or 2 arguments for use in a <code class="code-styler-inline">for</code> loop.</p></div><div class="el-p"><p dir="auto">Types can be defined like this (type aliasing):</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token keyword">type</span> myint<span class="token operator">=</span><span class="token builtin">int32</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Build tags, compiler directives:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token comment">// +build &lt;constraint&gt;</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Reminder about the special folder:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text">internal</div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Names within this folder cannot be imported from "outside" of this folder.</p></div><div class="el-p"><p dir="auto">Structure of a modern web application:<br>
<span alt="telegram-cloud-document-2-5312238323056530771.jpg" src="a9s/telegram-cloud-document-2-5312238323056530771.jpg" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="telegram-cloud-document-2-5312238323056530771.jpg" src="a9s/telegram-cloud-document-2-5312238323056530771.jpg" target="_self"></span></p></div><div class="el-p"><p dir="auto">Hexadecimal literals with a power of two exist:</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-go code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-go is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token number">0x1p11</span> <span class="token comment">// == 2^11 == 2048</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><button class="run-code-button">Run</button></pre></div><div class="el-p"><p dir="auto">Makefile — like a bash script-list where you can run code via aliases. Very convenient for:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>compilation/build</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>automation (tests, linting, deployment, containerization, etc.)</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>dependency management (came from C)</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>as documentation</li>
</ul></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all is-collapsed" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Mastering_Go_0" data-path="#Mastering_Go_0"><div class="tree-item-inner heading-link" heading-name="Mastering Go">Mastering Go</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_1_Introduction_0" data-path="#Chapter_1_Introduction_0"><div class="tree-item-inner heading-link" heading-name="Chapter 1: Introduction">Chapter 1: Introduction</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_2_Basic_Data_Types_0" data-path="#Chapter_2_Basic_Data_Types_0"><div class="tree-item-inner heading-link" heading-name="Chapter 2: Basic Data Types">Chapter 2: Basic Data Types</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_3_Composite_Types_0" data-path="#Chapter_3_Composite_Types_0"><div class="tree-item-inner heading-link" heading-name="Chapter 3: Composite Types">Chapter 3: Composite Types</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_4_Interfaces_Reflection_0" data-path="#Chapter_4_Interfaces_Reflection_0"><div class="tree-item-inner heading-link" heading-name="Chapter 4: Interfaces Reflection">Chapter 4: Interfaces Reflection</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_5_Go_Packages_and_Functions_0" data-path="#Chapter_5_Go_Packages_and_Functions_0"><div class="tree-item-inner heading-link" heading-name="Chapter 5: Go Packages and Functions">Chapter 5: Go Packages and Functions</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_6_Giving_Instructions_to_The_Unix_System_0" data-path="#Chapter_6_Giving_Instructions_to_The_Unix_System_0"><div class="tree-item-inner heading-link" heading-name="Chapter 6: Giving Instructions to The Unix System">Chapter 6: Giving Instructions to The Unix System</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_7_Parallel_Execution_0" data-path="#Chapter_7_Parallel_Execution_0"><div class="tree-item-inner heading-link" heading-name="Chapter 7: Parallel Execution">Chapter 7: Parallel Execution</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_8_Creating_Web_Services_0" data-path="#Chapter_8_Creating_Web_Services_0"><div class="tree-item-inner heading-link" heading-name="Chapter 8: Creating Web Services">Chapter 8: Creating Web Services</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_9_Working_with_TCP/IP_and_Web-Sockets_0" data-path="#Chapter_9_Working_with_TCP/IP_and_Web-Sockets_0"><div class="tree-item-inner heading-link" heading-name="Chapter 9: Working with TCP/IP and Web-Sockets">Chapter 9: Working with TCP/IP and Web-Sockets</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_10_Working_with_REST_API_0" data-path="#Chapter_10_Working_with_REST_API_0"><div class="tree-item-inner heading-link" heading-name="Chapter 10: Working with REST API">Chapter 10: Working with REST API</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_11_Testing_and_Profiling_0" data-path="#Chapter_11_Testing_and_Profiling_0"><div class="tree-item-inner heading-link" heading-name="Chapter 11: Testing and Profiling">Chapter 11: Testing and Profiling</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_12_gRPC_and_Protobuf_0" data-path="#Chapter_12_gRPC_and_Protobuf_0"><div class="tree-item-inner heading-link" heading-name="Chapter 12: gRPC and Protobuf">Chapter 12: gRPC and Protobuf</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Chapter_13_Generics_0" data-path="#Chapter_13_Generics_0"><div class="tree-item-inner heading-link" heading-name="Chapter 13: Generics">Chapter 13: Generics</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="mastering-go.html#Additional_0" data-path="#Additional_0"><div class="tree-item-inner heading-link" heading-name="Additional">Additional</div></a><div class="tree-item-children"></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>